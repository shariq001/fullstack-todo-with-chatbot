(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,92927,e=>{"use strict";let t="auth-token",s="auth-session",r=async()=>{try{return localStorage.getItem(t)}catch(e){return console.error("Error getting token:",e),null}};e.s(["clearAuthSession",0,()=>{localStorage.removeItem(t),localStorage.removeItem(s)},"getSession",0,()=>{try{{let e=localStorage.getItem(s);return e?JSON.parse(e):null}}catch{return null}},"getToken",0,r,"setSession",0,e=>{localStorage.setItem(s,JSON.stringify(e))},"setToken",0,e=>{localStorage.setItem(t,e)}])},32966,e=>{"use strict";var t=e.i(30668),s=e.i(96086),r=e.i(19478);e.s(["useAuth",0,()=>{let[e,a]=(0,t.useState)(null),[n,l]=(0,t.useState)(!1),[i,o]=(0,t.useState)(!0),c=(0,s.useRouter)();return(0,t.useEffect)(()=>{(async()=>{try{let e=r.AuthService.getCurrentSession();e?.user&&await r.AuthService.isAuthenticated()&&(a(e.user),l(!0))}catch(e){console.error("Auth check failed:",e)}finally{o(!1)}})()},[]),{user:e,isAuthenticated:n,loading:i,login:async e=>{o(!0);try{let t=await r.AuthService.login(e),s=r.AuthService.getCurrentSession();return s?.user&&(a(s.user),l(!0)),t}catch(e){throw console.error("Login error:",e),e}finally{o(!1)}},register:async e=>{o(!0);try{let t=await r.AuthService.register(e),s=r.AuthService.getCurrentSession();return s?.user&&(a(s.user),l(!0)),t}catch(e){throw console.error("Registration error:",e),e}finally{o(!1)}},logout:async()=>{o(!0);try{await r.AuthService.logout(),a(null),l(!1),c.push("/login")}catch(e){console.error("Logout error:",e)}finally{o(!1)}}}}])},56904,e=>{"use strict";var t=e.i(48277),s=e.i(30668),r=e.i(96086);function a(e,t=5e3){if(!e)return{valid:!1,error:"Message cannot be empty"};let s=e.trim();return 0===s.length?{valid:!1,error:"Message cannot be only whitespace"}:s.length>t?{valid:!1,error:`Message exceeds maximum length of ${t} characters`}:{valid:!0}}function n(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{let t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})}function l(e){if(e instanceof TypeError)return{code:"NETWORK_ERROR",message:"Network connection failed. Please check your connection.",action:"retry"};if("object"==typeof e&&null!==e&&"status"in e){let t=e.status;if(400===t)return{code:"VALIDATION_ERROR",message:"Invalid message. Please check your input and try again.",action:"clarify"};if(404===t)return{code:"NOT_FOUND",message:"Conversation not found. It may have been deleted. Start a new conversation.",action:"new"};if(401===t)return{code:"UNAUTHORIZED",message:"Your session has expired. Please log in again.",action:"login"};if(500===t)return{code:"SERVER_ERROR",message:"Server error. Please try again in a moment.",action:"retry"};if(503===t)return{code:"SERVICE_UNAVAILABLE",message:"Service temporarily unavailable. Please try again later.",action:"retry"}}return e instanceof Error&&e.message.includes("timeout")?{code:"TIMEOUT",message:"Request took too long. Please try again.",action:"retry"}:{code:"UNKNOWN_ERROR",message:"An unexpected error occurred. Please try again.",action:"retry"}}function i(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}e.i(39057);let o="https://mushariq-full-stack-todo.hf.space/api/chat",c="Request took too long. Please try again.",d="Conversation not found. It may have been deleted. Start a new conversation.",u="Failed to load conversation. Please try again.",m={user:"bg-blue-100 text-blue-900 rounded-lg",assistant:"bg-gray-100 text-gray-900 rounded-lg",system:"bg-yellow-50 text-yellow-800 rounded-lg"},g={user:"justify-end",assistant:"justify-start",system:"justify-center"},x="chat_last_conversation_id",h=({messages:e})=>(0,t.jsx)("div",{className:"space-y-4",children:e.map(e=>(0,t.jsx)(f,{message:e},e.id))}),f=({message:e})=>{let s=g[e.role],r=m[e.role],a="system"===e.role?"max-w-full":"max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg";return(0,t.jsx)("div",{className:`flex ${s}`,children:(0,t.jsxs)("div",{className:`${a} px-4 py-3 ${r} ${"system"===e.role?"text-center text-sm italic":""}`,role:"article","aria-label":e.isLoading?"Loading response":"Message",children:[e.isLoading&&e.toolName&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)("span",{className:"text-xs font-medium",children:["Executing ",e.toolName,"..."]}),(0,t.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full"}),(0,t.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-100"}),(0,t.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-200"})]}),e.isLoading&&!e.toolName&&(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full"}),(0,t.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-100"}),(0,t.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-200"})]}),!e.isLoading&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-sm break-words",children:e.content}),e.toolResult&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-current border-opacity-20",children:[(0,t.jsx)("p",{className:"text-xs font-semibold mb-1",children:e.toolName?`${e.toolName} Result:`:"Tool Result:"}),(0,t.jsx)("pre",{className:"text-xs overflow-x-auto bg-black bg-opacity-10 p-2 rounded",children:JSON.stringify(e.toolResult,null,2)})]}),e.error&&(0,t.jsxs)("div",{className:"mt-2 pt-2 border-t border-red-300",role:"alert",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-red-600",children:"Error:"}),(0,t.jsx)("p",{className:"text-xs text-red-600",children:e.error})]}),(0,t.jsx)("p",{className:"text-xs opacity-70 mt-1",children:function(e,t=!1){try{let s=new Date(e);if(t)return s.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return s.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit"})}catch(t){return e}}(e.createdAt)})]})]})})},y=({value:e,onChange:r,onSubmit:n,isLoading:l,disabled:i=!1})=>{let o=(0,s.useRef)(null),[c,d]=(0,s.useState)(null),u=async t=>{t.preventDefault();let s=a(e);if(!s.valid)return void d(s.error||"Invalid message");d(null);try{await n(e)}catch(e){d(e instanceof Error?e.message:"Failed to send message")}};return(0,s.useEffect)(()=>{o.current&&(o.current.style.height="auto",o.current.style.height=`${Math.min(o.current.scrollHeight,120)}px`)},[e]),(0,s.useEffect)(()=>{o.current?.focus()},[]),(0,t.jsxs)("form",{onSubmit:u,className:"space-y-3",children:[c&&(0,t.jsx)("div",{className:"text-sm text-red-600 bg-red-50 px-3 py-2 rounded border border-red-200",role:"alert",children:c}),(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsxs)("div",{className:"flex-1 relative",children:[(0,t.jsx)("label",{htmlFor:"message-input",className:"sr-only",children:"Message input"}),(0,t.jsx)("textarea",{ref:o,id:"message-input",value:e,onChange:e=>{r(e.target.value),d(null)},onKeyDown:e=>{if("Enter"===e.key&&!e.shiftKey&&!i){e.preventDefault();let t=o.current?.form;t&&t.dispatchEvent(new Event("submit",{bubbles:!0}))}},placeholder:"Type your message here...",disabled:i,maxLength:5e3,rows:1,className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all ${i?"bg-gray-100 text-gray-400 cursor-not-allowed opacity-50":"bg-white text-gray-900"} focus:opacity-100`,"aria-label":"Message input","aria-disabled":i,"aria-describedby":"character-count","data-testid":"message-input"})]}),(0,t.jsx)("button",{type:"submit",disabled:i||!e.trim(),className:`px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-offset-2 ${i||!e.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 focus:ring-blue-500"}`,"aria-label":l?"Sending message":"Send message","aria-busy":l,"data-testid":"send-button",children:l?(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("span",{className:"inline-block","aria-hidden":"true",children:(0,t.jsxs)("svg",{className:"w-4 h-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,t.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,t.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),"Sending..."]}):"Send"})]}),(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("p",{id:"character-count",className:"text-xs text-gray-500","aria-live":"polite","aria-atomic":"true",children:[e.length,"/",5e3," characters"]}),e.length>4500&&(0,t.jsx)("p",{className:"text-xs text-yellow-600",role:"status",children:"You are approaching the character limit"})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-400 italic",children:["Press ",(0,t.jsx)("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-gray-700",children:"Enter"})," to send,"," ",(0,t.jsx)("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-gray-700",children:"Shift+Enter"})," for new line"]})]})},b=({conversationId:e})=>{let m=(0,r.useRouter)(),g=(0,s.useRef)(null),{conversation:f,inputValue:b,setInputValue:p,sendMessage:j,loadConversationHistory:v,error:N,isLoading:w,clearError:S}=(()=>{let[e,t]=(0,s.useState)(null),[r,m]=(0,s.useState)(""),[g,h]=(0,s.useState)(null),[f,y]=(0,s.useState)(!1),b=(0,s.useCallback)(()=>{h(null)},[]),p=(0,s.useCallback)(async s=>{let r=a(s);if(!r.valid)return void h(r.error||"Message cannot be empty");b(),y(!0);try{let r={id:n(),role:"user",content:s.trim(),createdAt:new Date().toISOString(),isLoading:!1},a={...e||{id:"",messages:[],isLoading:!1,createdAt:new Date().toISOString()},messages:[...e?.messages||[],r],lastMessageAt:new Date().toISOString()};t(a),m("");let i={id:n(),role:"assistant",content:"Typing...",createdAt:new Date().toISOString(),isLoading:!0};t(e=>e?{...e,messages:[...e.messages,i]}:null);let d={message:s.trim(),conversation_id:e?.id},u=new AbortController,g=setTimeout(()=>u.abort(),3e4);try{let e=await fetch(o,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(d),signal:u.signal,credentials:"include"});if(clearTimeout(g),!e.ok){let t=await e.json().catch(()=>({})),s={status:e.status,...t},{message:r}=l(s);throw Error(r)}let s=await e.json(),r={id:n(),role:"assistant",content:s.response,toolName:s.toolName,toolResult:s.toolResult,createdAt:new Date().toISOString(),isLoading:!1};if(t(e=>{if(!e)return null;let t=e.messages.slice(0,-1);return t.push(r),{...e,id:s.conversation_id,messages:t,lastMessageAt:new Date().toISOString()}}),s.conversation_id)try{localStorage.setItem(x,JSON.stringify({id:s.conversation_id,lastAccessedAt:new Date().toISOString()}))}catch(e){console.warn("Failed to save conversation to localStorage:",e)}}catch(e){clearTimeout(g),t(e=>e?{...e,messages:e.messages.slice(0,-1)}:null),e instanceof Error?"AbortError"===e.name?h(c):h(e.message):h("An unexpected error occurred. Please try again.")}}catch(t){let{message:e}=l(t);h(e)}finally{y(!1)}},[e,b]),j=(0,s.useCallback)(async e=>{if(!e||!i(e))return h(d),[];y(!0),b();try{let s=new AbortController,r=setTimeout(()=>s.abort(),3e4);try{let a=await fetch(`${o}?conversation_id=${encodeURIComponent(e)}`,{method:"GET",headers:{"Content-Type":"application/json"},signal:s.signal,credentials:"include"});if(clearTimeout(r),!a.ok){if(404===a.status)h(d),localStorage.removeItem(x);else if(401===a.status)h("Your session has expired. Please log in again.");else throw Error(u);return[]}let n=await a.json();if(n.messages&&Array.isArray(n.messages)){let s={id:e,messages:n.messages,isLoading:!1,createdAt:n.createdAt||new Date().toISOString(),lastMessageAt:n.lastMessageAt||new Date().toISOString()};return t(s),n.messages}return[]}catch(e){return clearTimeout(r),e instanceof Error?"AbortError"===e.name?h(c):h(e.message):h(u),[]}}finally{y(!1)}},[b]),v=(0,s.useCallback)(()=>{try{let e=localStorage.getItem(x);if(!e)return null;try{let t=JSON.parse(e);if(t&&"object"==typeof t&&"id"in t){let e=t.id;return i(e)?e:null}}catch{if(i(e))return e}return null}catch{return null}},[]);return(0,s.useEffect)(()=>{if(!e){let e=v();e&&j(e)}},[]),{conversation:e,inputValue:r,setInputValue:m,sendMessage:p,loadConversationHistory:j,error:g,isLoading:f,clearError:b}})(),[A,k]=(0,s.useState)(!1);(0,s.useEffect)(()=>{let t=!0;return(async()=>{if(!e){t&&k(!1);return}if(!A||f?.id!==e)try{await v(e),t&&k(!0)}catch(e){t&&k(!0)}})(),()=>{t=!1}},[e,f?.id,A,v]),(0,s.useEffect)(()=>{g.current?.scrollIntoView({behavior:"smooth"})},[f?.messages]),(0,s.useEffect)(()=>{f?.id&&f.id!==e&&m.push(`/chat?id=${f.id}`,{scroll:!1})},[f?.id,e,m]);let E=async e=>{e.trim()&&await j(e)};return(0,t.jsxs)("div",{className:"flex flex-col h-[calc(100vh-200px)] bg-white rounded-lg border border-gray-200 shadow-sm",role:"region","aria-label":"Chat interface",children:[(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 bg-gray-50 max-h-screen",children:w&&(!f||0===f.messages.length)?(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:"flex justify-center mb-4",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"})}),(0,t.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading conversation..."})]})}):f&&0!==f.messages.length?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h,{messages:f.messages}),(0,t.jsx)("div",{ref:g})]}):(0,t.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,t.jsxs)("div",{className:"max-w-md",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Start a New Conversation"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:"Chat naturally to manage your tasks. Try asking something like:"}),(0,t.jsxs)("ul",{className:"text-sm text-gray-500 space-y-1 mb-4",children:[(0,t.jsx)("li",{children:'"Add a task: buy milk"'}),(0,t.jsx)("li",{children:'"List all my tasks"'}),(0,t.jsx)("li",{children:'"Mark task as done"'})]})]})})}),N&&(0,t.jsx)("div",{className:"px-6 py-4 bg-red-50 border-t border-red-200",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsx)("p",{className:"text-sm font-medium text-red-900",children:N})}),(0,t.jsxs)("button",{onClick:S,className:"ml-2 inline-flex text-red-400 hover:text-red-600 focus:outline-none transition-colors","aria-label":"Close error message",children:[(0,t.jsx)("span",{className:"sr-only",children:"Close"}),(0,t.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,t.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})}),(0,t.jsx)("div",{className:"border-t border-gray-200 p-6 bg-white",children:(0,t.jsx)(y,{value:b,onChange:p,onSubmit:E,isLoading:w,disabled:w})})]})};var p=e.i(32966);function j(){let e,a=(0,r.useSearchParams)();if(a){let t=a.get("id");t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(t)&&(e=t)}let{isAuthenticated:n,loading:l}=(0,p.useAuth)(),[i,o]=(0,s.useState)(!1);return((0,s.useEffect)(()=>{o(!0)},[]),l||!i)?(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading chat..."})]})}):n?(0,t.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,t.jsx)("header",{className:"bg-white border-b border-gray-200 shadow-sm",children:(0,t.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-4 flex justify-between items-start",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Todo Chat"}),(0,t.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Chat naturally to manage your tasks"})]}),(0,t.jsxs)("a",{href:"/dashboard",className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,t.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19H7a2 2 0 01-2-2m2 2h2a2 2 0 002-2M9 19l12-3"})}),"My Tasks"]})]})}),(0,t.jsx)("main",{className:"max-w-6xl mx-auto px-4 py-8",children:(0,t.jsx)(b,{conversationId:e||void 0})})]}):(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),(0,t.jsx)("p",{className:"text-gray-600 mb-6",children:"Please log in to use the chat feature."}),(0,t.jsx)("a",{href:"/login",className:"inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Go to Login"})]})})}function v(){return(0,t.jsx)(s.Suspense,{fallback:(0,t.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}),children:(0,t.jsx)(j,{})})}e.s(["default",()=>v,"dynamic",0,"force-dynamic"],56904)}]);