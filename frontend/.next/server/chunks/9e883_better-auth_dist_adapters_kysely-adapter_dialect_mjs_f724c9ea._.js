module.exports=[44871,e=>{"use strict";var t=e.i(11874);let r=(0,t.freeze)({is:e=>"AlterTableNode"===e.kind,create:e=>(0,t.freeze)({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,r)=>(0,t.freeze)({...e,...r}),cloneWithColumnAlteration:(e,r)=>(0,t.freeze)({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,r]:[r]})});var n=e.i(49216);let o=(0,t.freeze)({is:e=>"CreateIndexNode"===e.kind,create:e=>(0,t.freeze)({kind:"CreateIndexNode",name:n.IdentifierNode.create(e)}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r}),cloneWithColumns:(e,r)=>(0,t.freeze)({...e,columns:[...e.columns||[],...r]})}),i=(0,t.freeze)({is:e=>"CreateSchemaNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"CreateSchemaNode",schema:n.IdentifierNode.create(e),...r}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})});var s=e.i(24356),a=e.i(71145);let c=(0,t.freeze)({is:e=>"DropIndexNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"DropIndexNode",name:a.SchemableIdentifierNode.create(e),...r}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),l=(0,t.freeze)({is:e=>"DropSchemaNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"DropSchemaNode",schema:n.IdentifierNode.create(e),...r}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),u=(0,t.freeze)({is:e=>"DropTableNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"DropTableNode",table:e,...r}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})});var p=e.i(25466);let d=(0,t.freeze)({is:e=>"AddColumnNode"===e.kind,create:e=>(0,t.freeze)({kind:"AddColumnNode",column:e})});var h=e.i(2563);let m=(0,t.freeze)({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"ColumnDefinitionNode",column:h.ColumnNode.create(e),dataType:r}),cloneWithFrontModifier:(e,r)=>(0,t.freeze)({...e,frontModifiers:e.frontModifiers?(0,t.freeze)([...e.frontModifiers,r]):[r]}),cloneWithEndModifier:(e,r)=>(0,t.freeze)({...e,endModifiers:e.endModifiers?(0,t.freeze)([...e.endModifiers,r]):[r]}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),y=(0,t.freeze)({is:e=>"DropColumnNode"===e.kind,create:e=>(0,t.freeze)({kind:"DropColumnNode",column:h.ColumnNode.create(e)})}),w=(0,t.freeze)({is:e=>"RenameColumnNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"RenameColumnNode",column:h.ColumnNode.create(e),renameTo:h.ColumnNode.create(r)})}),f=(0,t.freeze)({is:e=>"CheckConstraintNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"CheckConstraintNode",expression:e,name:r?n.IdentifierNode.create(r):void 0})}),g=["no action","restrict","cascade","set null","set default"],b=(0,t.freeze)({is:e=>"ReferencesNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"ReferencesNode",table:e,columns:(0,t.freeze)([...r])}),cloneWithOnDelete:(e,r)=>(0,t.freeze)({...e,onDelete:r}),cloneWithOnUpdate:(e,r)=>(0,t.freeze)({...e,onUpdate:r})});var x=e.i(63657),N=e.i(54256),C=e.i(67450),_=e.i(89149);function T(e){return(0,C.isOperationNodeSource)(e)?e.toOperationNode():_.ValueNode.createImmediate(e)}let v=(0,t.freeze)({is:e=>"GeneratedNode"===e.kind,create:e=>(0,t.freeze)({kind:"GeneratedNode",...e}),createWithExpression:e=>(0,t.freeze)({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),I=(0,t.freeze)({is:e=>"DefaultValueNode"===e.kind,create:e=>(0,t.freeze)({kind:"DefaultValueNode",defaultValue:e})});function E(e){if(g.includes(e))return e;throw Error(`invalid OnModifyForeignAction ${e}`)}class q{#e;constructor(e){this.#e=e}autoIncrement(){return new q(m.cloneWith(this.#e,{autoIncrement:!0}))}identity(){return new q(m.cloneWith(this.#e,{identity:!0}))}primaryKey(){return new q(m.cloneWith(this.#e,{primaryKey:!0}))}references(e){let t=(0,N.parseStringReference)(e);if(!t.table||x.SelectAllNode.is(t.column))throw Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new q(m.cloneWith(this.#e,{references:b.create(t.table,[t.column])}))}onDelete(e){if(!this.#e.references)throw Error("on delete constraint can only be added for foreign keys");return new q(m.cloneWith(this.#e,{references:b.cloneWithOnDelete(this.#e.references,E(e))}))}onUpdate(e){if(!this.#e.references)throw Error("on update constraint can only be added for foreign keys");return new q(m.cloneWith(this.#e,{references:b.cloneWithOnUpdate(this.#e.references,E(e))}))}unique(){return new q(m.cloneWith(this.#e,{unique:!0}))}notNull(){return new q(m.cloneWith(this.#e,{notNull:!0}))}unsigned(){return new q(m.cloneWith(this.#e,{unsigned:!0}))}defaultTo(e){return new q(m.cloneWith(this.#e,{defaultTo:I.create(T(e))}))}check(e){return new q(m.cloneWith(this.#e,{check:f.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new q(m.cloneWith(this.#e,{generated:v.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new q(m.cloneWith(this.#e,{generated:v.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new q(m.cloneWith(this.#e,{generated:v.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#e.generated)throw Error("stored() can only be called after generatedAlwaysAs");return new q(m.cloneWith(this.#e,{generated:v.cloneWith(this.#e.generated,{stored:!0})}))}modifyFront(e){return new q(m.cloneWithFrontModifier(this.#e,e.toOperationNode()))}nullsNotDistinct(){return new q(m.cloneWith(this.#e,{nullsNotDistinct:!0}))}ifNotExists(){return new q(m.cloneWith(this.#e,{ifNotExists:!0}))}modifyEnd(e){return new q(m.cloneWithEndModifier(this.#e,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#e}}let W=(0,t.freeze)({is:e=>"ModifyColumnNode"===e.kind,create:e=>(0,t.freeze)({kind:"ModifyColumnNode",column:e})});var A=e.i(65133);let k=(0,t.freeze)({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,r,o,i)=>(0,t.freeze)({kind:"ForeignKeyConstraintNode",columns:e,references:b.create(r,o),name:i?n.IdentifierNode.create(i):void 0}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})});class Q{#e;constructor(e){this.#e=e}onDelete(e){return new Q(k.cloneWith(this.#e,{onDelete:E(e)}))}onUpdate(e){return new Q(k.cloneWith(this.#e,{onUpdate:E(e)}))}deferrable(){return new Q(k.cloneWith(this.#e,{deferrable:!0}))}notDeferrable(){return new Q(k.cloneWith(this.#e,{deferrable:!1}))}initiallyDeferred(){return new Q(k.cloneWith(this.#e,{initiallyDeferred:!0}))}initiallyImmediate(){return new Q(k.cloneWith(this.#e,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#e}}let D=(0,t.freeze)({is:e=>"AddConstraintNode"===e.kind,create:e=>(0,t.freeze)({kind:"AddConstraintNode",constraint:e})}),O=(0,t.freeze)({is:e=>"UniqueConstraintNode"===e.kind,create:(e,r,o)=>(0,t.freeze)({kind:"UniqueConstraintNode",columns:(0,t.freeze)(e.map(h.ColumnNode.create)),name:r?n.IdentifierNode.create(r):void 0,nullsNotDistinct:o}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),P=(0,t.freeze)({is:e=>"DropConstraintNode"===e.kind,create:e=>(0,t.freeze)({kind:"DropConstraintNode",constraintName:n.IdentifierNode.create(e)}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),z=(0,t.freeze)({is:e=>"AlterColumnNode"===e.kind,create:(e,r,n)=>(0,t.freeze)({kind:"AlterColumnNode",column:h.ColumnNode.create(e),[r]:n})});class S{#t;constructor(e){this.#t=e}setDataType(e){return new M(z.create(this.#t,"dataType",(0,A.parseDataTypeExpression)(e)))}setDefault(e){return new M(z.create(this.#t,"setDefault",T(e)))}dropDefault(){return new M(z.create(this.#t,"dropDefault",!0))}setNotNull(){return new M(z.create(this.#t,"setNotNull",!0))}dropNotNull(){return new M(z.create(this.#t,"dropNotNull",!0))}$call(e){return e(this)}}class M{#r;constructor(e){this.#r=e}toOperationNode(){return this.#r}}class L{#n;constructor(e){this.#n=(0,t.freeze)(e)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class R{#n;constructor(e){this.#n=(0,t.freeze)(e)}onDelete(e){return new R({...this.#n,constraintBuilder:this.#n.constraintBuilder.onDelete(e)})}onUpdate(e){return new R({...this.#n,constraintBuilder:this.#n.constraintBuilder.onUpdate(e)})}deferrable(){return new R({...this.#n,constraintBuilder:this.#n.constraintBuilder.deferrable()})}notDeferrable(){return new R({...this.#n,constraintBuilder:this.#n.constraintBuilder.notDeferrable()})}initiallyDeferred(){return new R({...this.#n,constraintBuilder:this.#n.constraintBuilder.initiallyDeferred()})}initiallyImmediate(){return new R({...this.#n,constraintBuilder:this.#n.constraintBuilder.initiallyImmediate()})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(r.cloneWithTableProps(this.#n.node,{addConstraint:D.create(this.#n.constraintBuilder.toOperationNode())}),this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class B{#n;constructor(e){this.#n=(0,t.freeze)(e)}ifExists(){return new B({...this.#n,node:r.cloneWithTableProps(this.#n.node,{dropConstraint:P.cloneWith(this.#n.node.dropConstraint,{ifExists:!0})})})}cascade(){return new B({...this.#n,node:r.cloneWithTableProps(this.#n.node,{dropConstraint:P.cloneWith(this.#n.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new B({...this.#n,node:r.cloneWithTableProps(this.#n.node,{dropConstraint:P.cloneWith(this.#n.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}let $=(0,t.freeze)({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"PrimaryKeyConstraintNode",columns:(0,t.freeze)(e.map(h.ColumnNode.create)),name:r?n.IdentifierNode.create(r):void 0}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})}),F=(0,t.freeze)({is:e=>"AddIndexNode"===e.kind,create:e=>(0,t.freeze)({kind:"AddIndexNode",name:n.IdentifierNode.create(e)}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r}),cloneWithColumns:(e,r)=>(0,t.freeze)({...e,columns:[...e.columns||[],...r]})});var U=e.i(18766);class V{#n;constructor(e){this.#n=(0,t.freeze)(e)}unique(){return new V({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addIndex:F.cloneWith(this.#n.node.addIndex,{unique:!0})})})}column(e){return new V({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addIndex:F.cloneWithColumns(this.#n.node.addIndex,[(0,N.parseOrderedColumnName)(e)])})})}columns(e){return new V({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addIndex:F.cloneWithColumns(this.#n.node.addIndex,e.map(N.parseOrderedColumnName))})})}expression(e){return new V({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addIndex:F.cloneWithColumns(this.#n.node.addIndex,[e.toOperationNode()])})})}using(e){return new V({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addIndex:F.cloneWith(this.#n.node.addIndex,{using:U.RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class j{#e;constructor(e){this.#e=e}nullsNotDistinct(){return new j(O.cloneWith(this.#e,{nullsNotDistinct:!0}))}deferrable(){return new j(O.cloneWith(this.#e,{deferrable:!0}))}notDeferrable(){return new j(O.cloneWith(this.#e,{deferrable:!1}))}initiallyDeferred(){return new j(O.cloneWith(this.#e,{initiallyDeferred:!0}))}initiallyImmediate(){return new j(O.cloneWith(this.#e,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#e}}class K{#e;constructor(e){this.#e=e}deferrable(){return new K($.cloneWith(this.#e,{deferrable:!0}))}notDeferrable(){return new K($.cloneWith(this.#e,{deferrable:!1}))}initiallyDeferred(){return new K($.cloneWith(this.#e,{initiallyDeferred:!0}))}initiallyImmediate(){return new K($.cloneWith(this.#e,{initiallyDeferred:!1}))}$call(e){return e(this)}toOperationNode(){return this.#e}}class G{#e;constructor(e){this.#e=e}$call(e){return e(this)}toOperationNode(){return this.#e}}let J=(0,t.freeze)({is:e=>"RenameConstraintNode"===e.kind,create:(e,r)=>(0,t.freeze)({kind:"RenameConstraintNode",oldName:n.IdentifierNode.create(e),newName:n.IdentifierNode.create(r)})});class Y{#n;constructor(e){this.#n=(0,t.freeze)(e)}renameTo(e){return new L({...this.#n,node:r.cloneWithTableProps(this.#n.node,{renameTo:(0,p.parseTable)(e)})})}setSchema(e){return new L({...this.#n,node:r.cloneWithTableProps(this.#n.node,{setSchema:n.IdentifierNode.create(e)})})}alterColumn(e,t){let n=t(new S(e));return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,n.toOperationNode())})}dropColumn(e){return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,y.create(e))})}renameColumn(e,t){return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,w.create(e,t))})}addColumn(e,n,o=t.noop){let i=o(new q(m.create(e,(0,A.parseDataTypeExpression)(n))));return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,d.create(i.toOperationNode()))})}modifyColumn(e,n,o=t.noop){let i=o(new q(m.create(e,(0,A.parseDataTypeExpression)(n))));return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,W.create(i.toOperationNode()))})}addUniqueConstraint(e,n,o=t.noop){let i=o(new j(O.create(n,e)));return new L({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addConstraint:D.create(i.toOperationNode())})})}addCheckConstraint(e,n,o=t.noop){let i=o(new G(f.create(n.toOperationNode(),e)));return new L({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addConstraint:D.create(i.toOperationNode())})})}addForeignKeyConstraint(e,r,n,o,i=t.noop){let s=i(new Q(k.create(r.map(h.ColumnNode.create),(0,p.parseTable)(n),o.map(h.ColumnNode.create),e)));return new R({...this.#n,constraintBuilder:s})}addPrimaryKeyConstraint(e,n,o=t.noop){let i=o(new K($.create(n,e)));return new L({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addConstraint:D.create(i.toOperationNode())})})}dropConstraint(e){return new B({...this.#n,node:r.cloneWithTableProps(this.#n.node,{dropConstraint:P.create(e)})})}renameConstraint(e,t){return new B({...this.#n,node:r.cloneWithTableProps(this.#n.node,{renameConstraint:J.create(e,t)})})}addIndex(e){return new V({...this.#n,node:r.cloneWithTableProps(this.#n.node,{addIndex:F.create(e)})})}dropIndex(e){return new L({...this.#n,node:r.cloneWithTableProps(this.#n.node,{dropIndex:c.create(e)})})}$call(e){return e(this)}}class H{#n;constructor(e){this.#n=(0,t.freeze)(e)}alterColumn(e,t){let n=t(new S(e));return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,n.toOperationNode())})}dropColumn(e){return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,y.create(e))})}renameColumn(e,t){return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,w.create(e,t))})}addColumn(e,n,o=t.noop){let i=o(new q(m.create(e,(0,A.parseDataTypeExpression)(n))));return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,d.create(i.toOperationNode()))})}modifyColumn(e,n,o=t.noop){let i=o(new q(m.create(e,(0,A.parseDataTypeExpression)(n))));return new H({...this.#n,node:r.cloneWithColumnAlteration(this.#n.node,W.create(i.toOperationNode()))})}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}var X=e.i(67545),Z=e.i(22164),ee=e.i(52154),et=e.i(34978);class er extends ee.OperationNodeTransformer{transformPrimitiveValueList(e){return et.ValueListNode.create(e.values.map(_.ValueNode.createImmediate))}transformValue(e){return _.ValueNode.createImmediate(e.value)}}class en{#n;constructor(e){this.#n=(0,t.freeze)(e)}ifNotExists(){return new en({...this.#n,node:o.cloneWith(this.#n.node,{ifNotExists:!0})})}unique(){return new en({...this.#n,node:o.cloneWith(this.#n.node,{unique:!0})})}nullsNotDistinct(){return new en({...this.#n,node:o.cloneWith(this.#n.node,{nullsNotDistinct:!0})})}on(e){return new en({...this.#n,node:o.cloneWith(this.#n.node,{table:(0,p.parseTable)(e)})})}column(e){return new en({...this.#n,node:o.cloneWithColumns(this.#n.node,[(0,N.parseOrderedColumnName)(e)])})}columns(e){return new en({...this.#n,node:o.cloneWithColumns(this.#n.node,e.map(N.parseOrderedColumnName))})}expression(e){return new en({...this.#n,node:o.cloneWithColumns(this.#n.node,[e.toOperationNode()])})}using(e){return new en({...this.#n,node:o.cloneWith(this.#n.node,{using:U.RawNode.createWithSql(e)})})}where(...e){let t=new er;return new en({...this.#n,node:Z.QueryNode.cloneWithWhere(this.#n.node,t.transformNode((0,X.parseValueBinaryOperationOrExpression)(e),this.#n.queryId))})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class eo{#n;constructor(e){this.#n=(0,t.freeze)(e)}ifNotExists(){return new eo({...this.#n,node:i.cloneWith(this.#n.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}var ei=e.i(95031);class es{#n;constructor(e){this.#n=(0,t.freeze)(e)}temporary(){return new es({...this.#n,node:s.CreateTableNode.cloneWith(this.#n.node,{temporary:!0})})}onCommit(e){return new es({...this.#n,node:s.CreateTableNode.cloneWith(this.#n.node,{onCommit:function(e){if(s.ON_COMMIT_ACTIONS.includes(e))return e;throw Error(`invalid OnCommitAction ${e}`)}(e)})})}ifNotExists(){return new es({...this.#n,node:s.CreateTableNode.cloneWith(this.#n.node,{ifNotExists:!0})})}addColumn(e,r,n=t.noop){let o=n(new q(m.create(e,(0,A.parseDataTypeExpression)(r))));return new es({...this.#n,node:s.CreateTableNode.cloneWithColumn(this.#n.node,o.toOperationNode())})}addPrimaryKeyConstraint(e,r,n=t.noop){let o=n(new K($.create(r,e)));return new es({...this.#n,node:s.CreateTableNode.cloneWithConstraint(this.#n.node,o.toOperationNode())})}addUniqueConstraint(e,r,n=t.noop){let o=n(new j(O.create(r,e)));return new es({...this.#n,node:s.CreateTableNode.cloneWithConstraint(this.#n.node,o.toOperationNode())})}addCheckConstraint(e,r,n=t.noop){let o=n(new G(f.create(r.toOperationNode(),e)));return new es({...this.#n,node:s.CreateTableNode.cloneWithConstraint(this.#n.node,o.toOperationNode())})}addForeignKeyConstraint(e,r,n,o,i=t.noop){let a=i(new Q(k.create(r.map(h.ColumnNode.create),(0,p.parseTable)(n),o.map(h.ColumnNode.create),e)));return new es({...this.#n,node:s.CreateTableNode.cloneWithConstraint(this.#n.node,a.toOperationNode())})}modifyFront(e){return new es({...this.#n,node:s.CreateTableNode.cloneWithFrontModifier(this.#n.node,e.toOperationNode())})}modifyEnd(e){return new es({...this.#n,node:s.CreateTableNode.cloneWithEndModifier(this.#n.node,e.toOperationNode())})}as(e){return new es({...this.#n,node:s.CreateTableNode.cloneWith(this.#n.node,{selectQuery:(0,ei.parseExpression)(e)})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class ea{#n;constructor(e){this.#n=(0,t.freeze)(e)}on(e){return new ea({...this.#n,node:c.cloneWith(this.#n.node,{table:(0,p.parseTable)(e)})})}ifExists(){return new ea({...this.#n,node:c.cloneWith(this.#n.node,{ifExists:!0})})}cascade(){return new ea({...this.#n,node:c.cloneWith(this.#n.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class ec{#n;constructor(e){this.#n=(0,t.freeze)(e)}ifExists(){return new ec({...this.#n,node:l.cloneWith(this.#n.node,{ifExists:!0})})}cascade(){return new ec({...this.#n,node:l.cloneWith(this.#n.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class el{#n;constructor(e){this.#n=(0,t.freeze)(e)}ifExists(){return new el({...this.#n,node:u.cloneWith(this.#n.node,{ifExists:!0})})}cascade(){return new el({...this.#n,node:u.cloneWith(this.#n.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}var eu=e.i(20461),ep=e.i(86870),ed=e.i(75780);class eh{#o=new er;transformQuery(e){return this.#o.transformNode(e.node,e.queryId)}transformResult(e){return Promise.resolve(e.result)}}class em{#n;constructor(e){this.#n=(0,t.freeze)(e)}temporary(){return new em({...this.#n,node:ed.CreateViewNode.cloneWith(this.#n.node,{temporary:!0})})}materialized(){return new em({...this.#n,node:ed.CreateViewNode.cloneWith(this.#n.node,{materialized:!0})})}ifNotExists(){return new em({...this.#n,node:ed.CreateViewNode.cloneWith(this.#n.node,{ifNotExists:!0})})}orReplace(){return new em({...this.#n,node:ed.CreateViewNode.cloneWith(this.#n.node,{orReplace:!0})})}columns(e){return new em({...this.#n,node:ed.CreateViewNode.cloneWith(this.#n.node,{columns:e.map(N.parseColumnName)})})}as(e){let t=e.withPlugin(new eh).toOperationNode();return new em({...this.#n,node:ed.CreateViewNode.cloneWith(this.#n.node,{as:t})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}let ey=(0,t.freeze)({is:e=>"DropViewNode"===e.kind,create:e=>(0,t.freeze)({kind:"DropViewNode",name:a.SchemableIdentifierNode.create(e)}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})});class ew{#n;constructor(e){this.#n=(0,t.freeze)(e)}materialized(){return new ew({...this.#n,node:ey.cloneWith(this.#n.node,{materialized:!0})})}ifExists(){return new ew({...this.#n,node:ey.cloneWith(this.#n.node,{ifExists:!0})})}cascade(){return new ew({...this.#n,node:ey.cloneWith(this.#n.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}let ef=(0,t.freeze)({is:e=>"CreateTypeNode"===e.kind,create:e=>(0,t.freeze)({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,r)=>(0,t.freeze)({...e,enum:et.ValueListNode.create(r.map(_.ValueNode.createImmediate))})});class eg{#n;constructor(e){this.#n=(0,t.freeze)(e)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}asEnum(e){return new eg({...this.#n,node:ef.cloneWithEnum(this.#n.node,e)})}$call(e){return e(this)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}let eb=(0,t.freeze)({is:e=>"DropTypeNode"===e.kind,create:e=>(0,t.freeze)({kind:"DropTypeNode",name:e}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})});class ex{#n;constructor(e){this.#n=(0,t.freeze)(e)}ifExists(){return new ex({...this.#n,node:eb.cloneWith(this.#n.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}function eN(e){if(!e.includes("."))return a.SchemableIdentifierNode.create(e);{let t=e.split(".").map(eC);if(2===t.length)return a.SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw Error(`invalid schemable identifier ${e}`)}}function eC(e){return e.trim()}let e_=(0,t.freeze)({is:e=>"RefreshMaterializedViewNode"===e.kind,create:e=>(0,t.freeze)({kind:"RefreshMaterializedViewNode",name:a.SchemableIdentifierNode.create(e)}),cloneWith:(e,r)=>(0,t.freeze)({...e,...r})});class eT{#n;constructor(e){this.#n=(0,t.freeze)(e)}concurrently(){return new eT({...this.#n,node:e_.cloneWith(this.#n.node,{concurrently:!0,withNoData:!1})})}withData(){return new eT({...this.#n,node:e_.cloneWith(this.#n.node,{withNoData:!1})})}withNoData(){return new eT({...this.#n,node:e_.cloneWith(this.#n.node,{withNoData:!0,concurrently:!1})})}$call(e){return e(this)}toOperationNode(){return this.#n.executor.transformQuery(this.#n.node,this.#n.queryId)}compile(){return this.#n.executor.compileQuery(this.toOperationNode(),this.#n.queryId)}async execute(){await this.#n.executor.executeQuery(this.compile())}}class ev{#i;constructor(e){this.#i=e}createTable(e){return new es({queryId:(0,eu.createQueryId)(),executor:this.#i,node:s.CreateTableNode.create((0,p.parseTable)(e))})}dropTable(e){return new el({queryId:(0,eu.createQueryId)(),executor:this.#i,node:u.create((0,p.parseTable)(e))})}createIndex(e){return new en({queryId:(0,eu.createQueryId)(),executor:this.#i,node:o.create(e)})}dropIndex(e){return new ea({queryId:(0,eu.createQueryId)(),executor:this.#i,node:c.create(e)})}createSchema(e){return new eo({queryId:(0,eu.createQueryId)(),executor:this.#i,node:i.create(e)})}dropSchema(e){return new ec({queryId:(0,eu.createQueryId)(),executor:this.#i,node:l.create(e)})}alterTable(e){return new Y({queryId:(0,eu.createQueryId)(),executor:this.#i,node:r.create((0,p.parseTable)(e))})}createView(e){return new em({queryId:(0,eu.createQueryId)(),executor:this.#i,node:ed.CreateViewNode.create(e)})}refreshMaterializedView(e){return new eT({queryId:(0,eu.createQueryId)(),executor:this.#i,node:e_.create(e)})}dropView(e){return new ew({queryId:(0,eu.createQueryId)(),executor:this.#i,node:ey.create(e)})}createType(e){return new eg({queryId:(0,eu.createQueryId)(),executor:this.#i,node:ef.create(eN(e))})}dropType(e){return new ex({queryId:(0,eu.createQueryId)(),executor:this.#i,node:eb.create(eN(e))})}withPlugin(e){return new ev(this.#i.withPlugin(e))}withoutPlugins(){return new ev(this.#i.withoutPlugins())}withSchema(e){return new ev(this.#i.withPluginAtFront(new ep.WithSchemaPlugin(e)))}}var eI=e.i(83514),eE=e.i(91659);class eq{ref(e){return new eI.DynamicReferenceBuilder(e)}table(e){return new eE.DynamicTableBuilder(e)}}class eW{#s;constructor(e){this.#s=e}async provideConnection(e){let t=await this.#s.acquireConnection();try{return await e(t)}finally{await this.#s.releaseConnection(t)}}}var eA=e.i(78710),ek=e.i(522);class eQ extends ek.QueryExecutorBase{#a;#c;#l;constructor(e,t,r,n=[]){super(n),this.#a=e,this.#c=t,this.#l=r}get adapter(){return this.#c}compileQuery(e,t){return this.#a.compileQuery(e,t)}provideConnection(e){return this.#l.provideConnection(e)}withPlugins(e){return new eQ(this.#a,this.#c,this.#l,[...this.plugins,...e])}withPlugin(e){return new eQ(this.#a,this.#c,this.#l,[...this.plugins,e])}withPluginAtFront(e){return new eQ(this.#a,this.#c,this.#l,[e,...this.plugins])}withConnectionProvider(e){return new eQ(this.#a,this.#c,e,[...this.plugins])}withoutPlugins(){return new eQ(this.#a,this.#c,this.#l,[])}}function eD(){return"u">typeof performance&&(0,t.isFunction)(performance.now)?performance.now():Date.now()}class eO{#s;#u;#p;#d;#h;#m=new WeakSet;constructor(e,t){this.#d=!1,this.#s=e,this.#u=t}async init(){if(this.#h)throw Error("driver has already been destroyed");this.#p||(this.#p=this.#s.init().then(()=>{this.#d=!0}).catch(e=>(this.#p=void 0,Promise.reject(e)))),await this.#p}async acquireConnection(){if(this.#h)throw Error("driver has already been destroyed");this.#d||await this.init();let e=await this.#s.acquireConnection();return this.#m.has(e)||(this.#y()&&this.#w(e),this.#m.add(e)),e}async releaseConnection(e){await this.#s.releaseConnection(e)}beginTransaction(e,t){return this.#s.beginTransaction(e,t)}commitTransaction(e){return this.#s.commitTransaction(e)}rollbackTransaction(e){return this.#s.rollbackTransaction(e)}savepoint(e,t,r){if(this.#s.savepoint)return this.#s.savepoint(e,t,r);throw Error("The `savepoint` method is not supported by this driver")}rollbackToSavepoint(e,t,r){if(this.#s.rollbackToSavepoint)return this.#s.rollbackToSavepoint(e,t,r);throw Error("The `rollbackToSavepoint` method is not supported by this driver")}releaseSavepoint(e,t,r){if(this.#s.releaseSavepoint)return this.#s.releaseSavepoint(e,t,r);throw Error("The `releaseSavepoint` method is not supported by this driver")}async destroy(){this.#p&&(await this.#p,this.#h||(this.#h=this.#s.destroy().catch(e=>(this.#h=void 0,Promise.reject(e)))),await this.#h)}#y(){return this.#u.isLevelEnabled("query")||this.#u.isLevelEnabled("error")}#w(e){let t=e.executeQuery,r=e.streamQuery,n=this;e.executeQuery=async r=>{let o,i=eD();try{return await t.call(e,r)}catch(e){throw o=e,await n.#f(e,r,i),e}finally{o||await n.#g(r,i)}},e.streamQuery=async function*(t,o){let i,s=eD();try{for await(let n of r.call(e,t,o))yield n}catch(e){throw i=e,await n.#f(e,t,s),e}finally{i||await n.#g(t,s,!0)}}}async #f(e,t,r){await this.#u.error(()=>({level:"error",error:e,query:t,queryDurationMillis:this.#b(r)}))}async #g(e,t,r=!1){await this.#u.query(()=>({level:"query",isStream:r,query:e,queryDurationMillis:this.#b(t)}))}#b(e){return eD()-e}}let eP=()=>{};class ez{#x;#N;constructor(e){this.#x=e}async provideConnection(e){for(;this.#N;)await this.#N.catch(eP);return this.#N=this.#C(e).finally(()=>{this.#N=void 0}),this.#N}async #C(e){return await e(this.#x)}}let eS=["read only","read write"],eM=["read uncommitted","read committed","repeatable read","serializable","snapshot"];function eL(e){if(e.accessMode&&!eS.includes(e.accessMode))throw Error(`invalid transaction access mode ${e.accessMode}`);if(e.isolationLevel&&!eM.includes(e.isolationLevel))throw Error(`invalid transaction isolation level ${e.isolationLevel}`)}var eR=e.i(39914);(0,t.freeze)(["query","error"]);class eB{#_;#T;constructor(e){(0,t.isFunction)(e)?(this.#T=e,this.#_=(0,t.freeze)({query:!0,error:!0})):(this.#T=e$,this.#_=(0,t.freeze)({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#_[e]}async query(e){this.#_.query&&await this.#T(e())}async error(e){this.#_.error&&await this.#T(e())}}function e$(e){if("query"===e.level){let t=`kysely:query:${e.isStream?"stream:":""}`;console.log(`${t} ${e.query.sql}`),console.log(`${t} duration: ${e.queryDurationMillis.toFixed(1)}ms`)}else"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}var eF=e.i(32150),eU=e.i(58971),eV=e.i(8120),ej=e.i(74988);Symbol.asyncDispose??=Symbol("Symbol.asyncDispose");class eK extends eA.QueryCreator{#n;constructor(e){let r,n;if(function(e){return(0,t.isObject)(e)&&(0,t.isObject)(e.config)&&(0,t.isObject)(e.driver)&&(0,t.isObject)(e.executor)&&(0,t.isObject)(e.dialect)}(e))r={executor:e.executor},n={...e};else{const t=e.dialect,o=t.createDriver(),i=t.createQueryCompiler(),s=t.createAdapter(),a=new eO(o,new eB(e.log??[])),c=new eQ(i,s,new eW(a),e.plugins??[]);r={executor:c},n={config:e,executor:c,dialect:t,driver:a}}super(r),this.#n=(0,t.freeze)(n)}get schema(){return new ev(this.#n.executor)}get dynamic(){return new eq}get introspection(){return this.#n.dialect.createIntrospector(this.withoutPlugins())}case(e){return new eF.CaseBuilder({node:eU.CaseNode.create((0,t.isUndefined)(e)?void 0:(0,ei.parseExpression)(e))})}get fn(){return(0,eR.createFunctionModule)()}transaction(){return new eY({...this.#n})}startTransaction(){return new eH({...this.#n})}connection(){return new eJ({...this.#n})}withPlugin(e){return new eK({...this.#n,executor:this.#n.executor.withPlugin(e)})}withoutPlugins(){return new eK({...this.#n,executor:this.#n.executor.withoutPlugins()})}withSchema(e){return new eK({...this.#n,executor:this.#n.executor.withPluginAtFront(new ep.WithSchemaPlugin(e))})}withTables(){return new eK({...this.#n})}async destroy(){await this.#n.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#n.executor}executeQuery(e,r){void 0!==r&&(0,ej.logOnce)("Passing `queryId` in `db.executeQuery` is deprecated and will result in a compile-time error in the future.");let n=(0,t.isObject)(e)&&(0,t.isFunction)(e.compile)?e.compile():e;return this.getExecutor().executeQuery(n)}async [Symbol.asyncDispose](){await this.destroy()}}class eG extends eK{#n;constructor(e){super(e),this.#n=e}get isTransaction(){return!0}transaction(){throw Error("calling the transaction method for a Transaction is not supported")}connection(){throw Error("calling the connection method for a Transaction is not supported")}async destroy(){throw Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new eG({...this.#n,executor:this.#n.executor.withPlugin(e)})}withoutPlugins(){return new eG({...this.#n,executor:this.#n.executor.withoutPlugins()})}withSchema(e){return new eG({...this.#n,executor:this.#n.executor.withPluginAtFront(new ep.WithSchemaPlugin(e))})}withTables(){return new eG({...this.#n})}}class eJ{#n;constructor(e){this.#n=(0,t.freeze)(e)}async execute(e){return this.#n.executor.provideConnection(async t=>{let r=this.#n.executor.withConnectionProvider(new ez(t)),n=new eK({...this.#n,executor:r});return await e(n)})}}class eY{#n;constructor(e){this.#n=(0,t.freeze)(e)}setAccessMode(e){return new eY({...this.#n,accessMode:e})}setIsolationLevel(e){return new eY({...this.#n,isolationLevel:e})}async execute(e){let{isolationLevel:t,accessMode:r,...n}=this.#n,o={isolationLevel:t,accessMode:r};return eL(o),this.#n.executor.provideConnection(async t=>{let r={isCommitted:!1,isRolledBack:!1},i=new e1(this.#n.executor.withConnectionProvider(new ez(t)),r),s=new eG({...n,executor:i}),a=!1;try{await this.#n.driver.beginTransaction(t,o),a=!0;let n=await e(s);return await this.#n.driver.commitTransaction(t),r.isCommitted=!0,n}catch(e){throw a&&(await this.#n.driver.rollbackTransaction(t),r.isRolledBack=!0),e}})}}class eH{#n;constructor(e){this.#n=(0,t.freeze)(e)}setAccessMode(e){return new eH({...this.#n,accessMode:e})}setIsolationLevel(e){return new eH({...this.#n,isolationLevel:e})}async execute(){let{isolationLevel:e,accessMode:t,...r}=this.#n,n={isolationLevel:e,accessMode:t};eL(n);let o=await (0,eV.provideControlledConnection)(this.#n.executor);return await this.#n.driver.beginTransaction(o.connection,n),new eX({...r,connection:o,executor:this.#n.executor.withConnectionProvider(new ez(o.connection))})}}class eX extends eG{#n;#v;#I;constructor(e){const r={isCommitted:!1,isRolledBack:!1},{connection:n,...o}=e={...e,executor:new e1(e.executor,r)};super(o),this.#n=(0,t.freeze)(e),this.#I=r;const i=(0,eu.createQueryId)();this.#v=t=>e.executor.compileQuery(t,i)}get isCommitted(){return this.#I.isCommitted}get isRolledBack(){return this.#I.isRolledBack}commit(){return e0(this.#I),new eZ(async()=>{await this.#n.driver.commitTransaction(this.#n.connection.connection),this.#I.isCommitted=!0,this.#n.connection.release()})}rollback(){return e0(this.#I),new eZ(async()=>{await this.#n.driver.rollbackTransaction(this.#n.connection.connection),this.#I.isRolledBack=!0,this.#n.connection.release()})}savepoint(e){return e0(this.#I),new eZ(async()=>(await this.#n.driver.savepoint?.(this.#n.connection.connection,e,this.#v),new eX({...this.#n})))}rollbackToSavepoint(e){return e0(this.#I),new eZ(async()=>(await this.#n.driver.rollbackToSavepoint?.(this.#n.connection.connection,e,this.#v),new eX({...this.#n})))}releaseSavepoint(e){return e0(this.#I),new eZ(async()=>(await this.#n.driver.releaseSavepoint?.(this.#n.connection.connection,e,this.#v),new eX({...this.#n})))}withPlugin(e){return new eX({...this.#n,executor:this.#n.executor.withPlugin(e)})}withoutPlugins(){return new eX({...this.#n,executor:this.#n.executor.withoutPlugins()})}withSchema(e){return new eX({...this.#n,executor:this.#n.executor.withPluginAtFront(new ep.WithSchemaPlugin(e))})}withTables(){return new eX({...this.#n})}}class eZ{#E;constructor(e){this.#E=e}async execute(){return await this.#E()}}function e0(e){if(e.isCommitted)throw Error("Transaction is already committed");if(e.isRolledBack)throw Error("Transaction is already rolled back")}class e1{#i;#I;constructor(e,t){e instanceof e1?this.#i=e.#i:this.#i=e,this.#I=t}get adapter(){return this.#i.adapter}get plugins(){return this.#i.plugins}transformQuery(e,t){return this.#i.transformQuery(e,t)}compileQuery(e,t){return this.#i.compileQuery(e,t)}provideConnection(e){return this.#i.provideConnection(e)}executeQuery(e){return e0(this.#I),this.#i.executeQuery(e)}stream(e,t){return e0(this.#I),this.#i.stream(e,t)}withConnectionProvider(e){return new e1(this.#i.withConnectionProvider(e),this.#I)}withPlugin(e){return new e1(this.#i.withPlugin(e),this.#I)}withPlugins(e){return new e1(this.#i.withPlugins(e),this.#I)}withPluginAtFront(e){return new e1(this.#i.withPluginAtFront(e),this.#I)}withoutPlugins(){return new e1(this.#i.withoutPlugins(),this.#I)}}var e4=e.i(830),e8=e.i(47908);class e3{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class e7 extends e3{get supportsCreateIfNotExists(){return!1}get supportsTransactionalDdl(){return!0}get supportsOutput(){return!0}async acquireMigrationLock(e){await e8.sql`exec sp_getapplock @DbPrincipal = ${e8.sql.lit("dbo")}, @Resource = ${e8.sql.lit(e4.DEFAULT_MIGRATION_TABLE)}, @LockMode = ${e8.sql.lit("Exclusive")}`.execute(e)}async releaseMigrationLock(){}}var e6=e.i(63692);function e2(e,r){var n;if(n=e,(0,t.isObject)(n)&&(0,t.isString)(n.stack)&&r.stack){let t=r.stack.split("\n").slice(1).join("\n");e.stack+=`
${t}`}return e}var e5=e.i(80173),e9=e.i(32439);let te=Symbol(),tt=Symbol(),tr=Symbol();class tn{#q;#W;constructor(e){this.#q=(0,t.freeze)({...e});const{tarn:r,tedious:n,validateConnections:o}=this.#q,{validateConnections:i,...s}=r.options;this.#W=new r.Pool({...s,create:async()=>{let e=await n.connectionFactory();return await new to(e,n).connect()},destroy:async e=>{await e[tt]()},validate:!1===o||!1===i?void 0:e=>e[tr]()})}async init(){}async acquireConnection(){return await this.#W.acquire().promise}async beginTransaction(e,t){await e.beginTransaction(t)}async commitTransaction(e){await e.commitTransaction()}async rollbackTransaction(e){await e.rollbackTransaction()}async savepoint(e,t){await e.savepoint(t)}async rollbackToSavepoint(e,t){await e.rollbackTransaction(t)}async releaseConnection(e){(this.#q.resetConnectionsOnRelease||this.#q.tedious.resetConnectionOnRelease)&&await e[te](),this.#W.release(e)}async destroy(){await this.#W.destroy()}}class to{#x;#A;#k;constructor(e,t){this.#x=e,this.#A=!1,this.#k=t}async beginTransaction(e){let{isolationLevel:t}=e;await new Promise((e,r)=>this.#x.beginTransaction(t=>{t?r(t):e(void 0)},t?(0,e5.randomString)(8):void 0,t?this.#Q(t):void 0))}async commitTransaction(){await new Promise((e,t)=>this.#x.commitTransaction(r=>{r?t(r):e(void 0)}))}async connect(){let{promise:e,reject:t,resolve:r}=new e9.Deferred;function n(){t(Error("The connection ended without ever completing the connection"))}return this.#x.connect(e=>{if(e)return t(e);r()}),this.#x.on("error",e=>{e instanceof Error&&"code"in e&&"ESOCKET"===e.code&&(this.#A=!0),console.error(e),t(e)}),this.#x.once("end",n),await e,this.#x.off("end",n),this}async executeQuery(e){try{let t=new e9.Deferred,r=new ti({compiledQuery:e,tedious:this.#k,onDone:t});this.#x.execSql(r.request);let{rowCount:n,rows:o}=await t.promise;return{numAffectedRows:void 0!==n?BigInt(n):void 0,rows:o}}catch(e){throw e2(e,Error())}}async rollbackTransaction(e){await new Promise((t,r)=>this.#x.rollbackTransaction(e=>{e?r(e):t(void 0)},e))}async savepoint(e){await new Promise((t,r)=>this.#x.saveTransaction(e=>{e?r(e):t(void 0)},e))}async *streamQuery(e,t){if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let r=new ti({compiledQuery:e,streamChunkSize:t,tedious:this.#k});this.#x.execSql(r.request);try{for(;;){let e=await r.readChunk();if(0===e.length||(yield{rows:e},e.length<t))break}}finally{await this.#D(r)}}#Q(e){let{ISOLATION_LEVEL:t}=this.#k,r={"read committed":t.READ_COMMITTED,"read uncommitted":t.READ_UNCOMMITTED,"repeatable read":t.REPEATABLE_READ,serializable:t.SERIALIZABLE,snapshot:t.SNAPSHOT}[e];if(void 0===r)throw Error(`Unknown isolation level: ${e}`);return r}#D(e){return new Promise(t=>{e.request.once("requestCompleted",t),this.#x.cancel()||(e.request.off("requestCompleted",t),t())})}[tt](){return"closed"in this.#x&&this.#x.closed?Promise.resolve():new Promise(e=>{this.#x.once("end",e),this.#x.close()})}async [te](){await new Promise((e,t)=>{this.#x.reset(r=>{if(r)return t(r);e()})})}async [tr](){if(this.#A||this.#O())return!1;try{let e=new e9.Deferred,t=new ti({compiledQuery:e6.CompiledQuery.raw("select 1"),onDone:e,tedious:this.#k});return this.#x.execSql(t.request),await e.promise,!0}catch{return!1}}#O(){return"closed"in this.#x&&!!this.#x.closed}}class ti{#P;#z;#S;#M;#k;#L;constructor(e){const{compiledQuery:t,onDone:r,streamChunkSize:n,tedious:o}=e;if(this.#z=[],this.#S=n,this.#M={},this.#k=o,r){const e="onDone";this.#M[e]=(t,n)=>{if("chunkReady"!==t){if(delete this.#M[e],"error"===t)return r.reject(n);r.resolve({rowCount:this.#L,rows:this.#z})}}}this.#P=new this.#k.Request(t.sql,(e,t)=>{if(e)return Object.values(this.#M).forEach(t=>t("error",e instanceof AggregateError?e.errors:e));this.#L=t}),this.#R(t.parameters),this.#B()}get request(){return this.#P}readChunk(){let e=this.readChunk.name;return new Promise((t,r)=>{this.#M[e]=(n,o)=>{if(delete this.#M[e],"error"===n)return r(o);t(this.#z.splice(0,this.#S))},this.#P.resume()})}#R(e){for(let t=0;t<e.length;t++){let r=e[t];this.#P.addParameter(String(t+1),this.#$(r),r)}}#B(){let e=this.#S?()=>{this.#S<=this.#z.length&&(this.#P.pause(),Object.values(this.#M).forEach(e=>e("chunkReady")))}:()=>{},t=t=>{let r={};for(let e of t)r[e.metadata.colName]=e.value;this.#z.push(r),e()};this.#P.on("row",t),this.#P.once("requestCompleted",()=>{Object.values(this.#M).forEach(e=>e("completed")),this.#P.off("row",t)})}#$(e){if((0,t.isNull)(e)||(0,t.isUndefined)(e)||(0,t.isString)(e))return this.#k.TYPES.NVarChar;if((0,t.isBigInt)(e)||(0,t.isNumber)(e)&&e%1==0)if(e<-0x80000000||e>0x7fffffff)return this.#k.TYPES.BigInt;else return this.#k.TYPES.Int;return(0,t.isNumber)(e)?this.#k.TYPES.Float:(0,t.isBoolean)(e)?this.#k.TYPES.Bit:(0,t.isDate)(e)?this.#k.TYPES.DateTime:(0,t.isBuffer)(e)?this.#k.TYPES.VarBinary:this.#k.TYPES.NVarChar}}class ts{#F;constructor(e){this.#F=e}async getSchemas(){return await this.#F.selectFrom("sys.schemas").select("name").execute()}async getTables(e={withInternalKyselyTables:!1}){let r=await this.#F.selectFrom("sys.tables as tables").leftJoin("sys.schemas as table_schemas","table_schemas.schema_id","tables.schema_id").innerJoin("sys.columns as columns","columns.object_id","tables.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",e=>e.onRef("comments.major_id","=","tables.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).$if(!e.withInternalKyselyTables,e=>e.where("tables.name","!=",e4.DEFAULT_MIGRATION_TABLE).where("tables.name","!=",e4.DEFAULT_MIGRATION_LOCK_TABLE)).select(["tables.name as table_name",e=>e.ref("tables.type").$castTo().as("table_type"),"table_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"]).unionAll(this.#F.selectFrom("sys.views as views").leftJoin("sys.schemas as view_schemas","view_schemas.schema_id","views.schema_id").innerJoin("sys.columns as columns","columns.object_id","views.object_id").innerJoin("sys.types as types","types.user_type_id","columns.user_type_id").leftJoin("sys.schemas as type_schemas","type_schemas.schema_id","types.schema_id").leftJoin("sys.extended_properties as comments",e=>e.onRef("comments.major_id","=","views.object_id").onRef("comments.minor_id","=","columns.column_id").on("comments.name","=","MS_Description")).select(["views.name as table_name","views.type as table_type","view_schemas.name as table_schema_name","columns.default_object_id as column_default_object_id","columns.generated_always_type_desc as column_generated_always_type","columns.is_computed as column_is_computed","columns.is_identity as column_is_identity","columns.is_nullable as column_is_nullable","columns.is_rowguidcol as column_is_rowguidcol","columns.name as column_name","types.is_nullable as type_is_nullable","types.name as type_name","type_schemas.name as type_schema_name","comments.value as column_comment"])).orderBy("table_schema_name").orderBy("table_name").orderBy("column_name").execute(),n={};for(let e of r){let r=`${e.table_schema_name}.${e.table_name}`;(n[r]=n[r]||(0,t.freeze)({columns:[],isView:"V "===e.table_type,name:e.table_name,schema:e.table_schema_name??void 0})).columns.push((0,t.freeze)({dataType:e.type_name,dataTypeSchema:e.type_schema_name??void 0,hasDefaultValue:e.column_default_object_id>0||"NOT_APPLICABLE"!==e.column_generated_always_type||e.column_is_identity||e.column_is_computed||e.column_is_rowguidcol,isAutoIncrementing:e.column_is_identity,isNullable:e.column_is_nullable&&e.type_is_nullable,name:e.column_name,comment:e.column_comment??void 0}))}return Object.values(n)}async getMetadata(e){return{tables:await this.getTables(e)}}}var ta=e.i(20204);let tc=/^[a-z0-9_]$/i;class tl extends ta.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return`@${this.numParameters}`}visitOffset(e){super.visitOffset(e),this.append(" rows")}compileColumnAlterations(e){let t={};for(let r of e)t[r.kind]||(t[r.kind]=[]),t[r.kind].push(r);let r=!0;t.AddColumnNode&&(this.append("add "),this.compileList(t.AddColumnNode),r=!1),t.AlterColumnNode&&(r||this.append(", "),this.compileList(t.AlterColumnNode)),t.DropColumnNode&&(r||this.append(", "),this.append("drop column "),this.compileList(t.DropColumnNode)),t.ModifyColumnNode&&(r||this.append(", "),this.compileList(t.ModifyColumnNode)),t.RenameColumnNode&&(r||this.append(", "),this.compileList(t.RenameColumnNode))}visitAddColumn(e){this.visitNode(e.column)}visitDropColumn(e){this.visitNode(e.column)}visitMergeQuery(e){super.visitMergeQuery(e),this.append(";")}visitCollate(e){this.append("collate ");let{name:t}=e.collation;for(let e of t)if(!tc.test(e))throw Error(`Invalid collation: ${t}`);this.append(t)}announcesNewColumnDataType(){return!1}}class tu{#q;constructor(e){this.#q=e}createDriver(){return new tn(this.#q)}createQueryCompiler(){return new tl}createAdapter(){return new e7}createIntrospector(e){return new ts(e)}}function tp(e,t){return U.RawNode.createWithChildren([U.RawNode.createWithSql(`${e} `),n.IdentifierNode.create(t)])}let td=Symbol();class th{#q;#m=new WeakMap;#W;constructor(e){this.#q=(0,t.freeze)({...e})}async init(){this.#W=(0,t.isFunction)(this.#q.pool)?await this.#q.pool():this.#q.pool}async acquireConnection(){let e=await this.#U(),t=this.#m.get(e);return!t&&(t=new tm(e),this.#m.set(e,t),this.#q?.onCreateConnection&&await this.#q.onCreateConnection(t)),this.#q?.onReserveConnection&&await this.#q.onReserveConnection(t),t}async #U(){return new Promise((e,t)=>{this.#W.getConnection(async(r,n)=>{r?t(r):e(n)})})}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let r=[];t.isolationLevel&&r.push(`isolation level ${t.isolationLevel}`),t.accessMode&&r.push(t.accessMode);let n=`set transaction ${r.join(", ")}`;await e.executeQuery(e6.CompiledQuery.raw(n))}await e.executeQuery(e6.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(tp("savepoint",t),(0,eu.createQueryId)()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(tp("rollback to",t),(0,eu.createQueryId)()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(tp("release savepoint",t),(0,eu.createQueryId)()))}async releaseConnection(e){e[td]()}async destroy(){return new Promise((e,t)=>{this.#W.end(r=>{r?t(r):e()})})}}class tm{#V;constructor(e){this.#V=e}async executeQuery(e){try{let r=await this.#j(e);if((0,t.isObject)(r)&&"insertId"in r&&"affectedRows"in r){let{insertId:e,affectedRows:t,changedRows:n}=r;return{insertId:null!=e&&"0"!==e.toString()?BigInt(e):void 0,numAffectedRows:null!=t?BigInt(t):void 0,numChangedRows:null!=n?BigInt(n):void 0,rows:[]}}if(Array.isArray(r))return{rows:r};return{rows:[]}}catch(e){throw e2(e,Error())}}#j(e){return new Promise((t,r)=>{this.#V.query(e.sql,e.parameters,(e,n)=>{e?r(e):t(n)})})}async *streamQuery(e,t){let r=this.#V.query(e.sql,e.parameters).stream({objectMode:!0});try{for await(let e of r)yield{rows:[e]}}catch(e){if(e&&"object"==typeof e&&"code"in e&&"ERR_STREAM_PREMATURE_CLOSE"===e.code)return;throw e}}[td](){this.#V.release()}}var ty=ta;let tw=/`/g;class tf extends ty.DefaultQueryCompiler{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getExplainOptionAssignment(){return"="}getExplainOptionsDelimiter(){return" "}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return"`"}getRightIdentifierWrapper(){return"`"}sanitizeIdentifier(e){return e.replace(tw,"``")}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.using&&(this.append(" using "),this.visitNode(e.using)),e.table&&(this.append(" on "),this.visitNode(e.table)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.where&&(this.append(" "),this.visitNode(e.where))}}class tg{#F;constructor(e){this.#F=e}async getSchemas(){return(await this.#F.selectFrom("information_schema.schemata").select("schema_name").$castTo().execute()).map(e=>({name:e.SCHEMA_NAME}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#F.selectFrom("information_schema.columns as columns").innerJoin("information_schema.tables as tables",e=>e.onRef("columns.TABLE_CATALOG","=","tables.TABLE_CATALOG").onRef("columns.TABLE_SCHEMA","=","tables.TABLE_SCHEMA").onRef("columns.TABLE_NAME","=","tables.TABLE_NAME")).select(["columns.COLUMN_NAME","columns.COLUMN_DEFAULT","columns.TABLE_NAME","columns.TABLE_SCHEMA","tables.TABLE_TYPE","columns.IS_NULLABLE","columns.DATA_TYPE","columns.EXTRA","columns.COLUMN_COMMENT"]).where("columns.TABLE_SCHEMA","=",e8.sql`database()`).orderBy("columns.TABLE_NAME").orderBy("columns.ORDINAL_POSITION").$castTo();e.withInternalKyselyTables||(t=t.where("columns.TABLE_NAME","!=",e4.DEFAULT_MIGRATION_TABLE).where("columns.TABLE_NAME","!=",e4.DEFAULT_MIGRATION_LOCK_TABLE));let r=await t.execute();return this.#K(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#K(e){return e.reduce((e,r)=>{let n=e.find(e=>e.name===r.TABLE_NAME);return n||(n=(0,t.freeze)({name:r.TABLE_NAME,isView:"VIEW"===r.TABLE_TYPE,schema:r.TABLE_SCHEMA,columns:[]}),e.push(n)),n.columns.push((0,t.freeze)({name:r.COLUMN_NAME,dataType:r.DATA_TYPE,isNullable:"YES"===r.IS_NULLABLE,isAutoIncrementing:r.EXTRA.toLowerCase().includes("auto_increment"),hasDefaultValue:null!==r.COLUMN_DEFAULT,comment:""===r.COLUMN_COMMENT?void 0:r.COLUMN_COMMENT})),e},[])}}let tb="ea586330-2c93-47c8-908d-981d9d270f9d";class tx extends e3{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}async acquireMigrationLock(e,t){await e8.sql`select get_lock(${e8.sql.lit(tb)}, ${e8.sql.lit(3600)})`.execute(e)}async releaseMigrationLock(e,t){await e8.sql`select release_lock(${e8.sql.lit(tb)})`.execute(e)}}class tN{#q;constructor(e){this.#q=e}createDriver(){return new th(this.#q)}createQueryCompiler(){return new tf}createAdapter(){return new tx}createIntrospector(e){return new tg(e)}}let tC=Symbol();class t_{#q;#m=new WeakMap;#W;constructor(e){this.#q=(0,t.freeze)({...e})}async init(){this.#W=(0,t.isFunction)(this.#q.pool)?await this.#q.pool():this.#q.pool}async acquireConnection(){let e=await this.#W.connect(),t=this.#m.get(e);return!t&&(t=new tT(e,{cursor:this.#q.cursor??null}),this.#m.set(e,t),this.#q.onCreateConnection&&await this.#q.onCreateConnection(t)),this.#q.onReserveConnection&&await this.#q.onReserveConnection(t),t}async beginTransaction(e,t){if(t.isolationLevel||t.accessMode){let r="start transaction";t.isolationLevel&&(r+=` isolation level ${t.isolationLevel}`),t.accessMode&&(r+=` ${t.accessMode}`),await e.executeQuery(e6.CompiledQuery.raw(r))}else await e.executeQuery(e6.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(tp("savepoint",t),(0,eu.createQueryId)()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(tp("rollback to",t),(0,eu.createQueryId)()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(tp("release",t),(0,eu.createQueryId)()))}async releaseConnection(e){e[tC]()}async destroy(){if(this.#W){let e=this.#W;this.#W=void 0,await e.end()}}}class tT{#G;#J;constructor(e,t){this.#G=e,this.#J=t}async executeQuery(e){try{let{command:t,rowCount:r,rows:n}=await this.#G.query(e.sql,[...e.parameters]);return{numAffectedRows:"INSERT"===t||"UPDATE"===t||"DELETE"===t||"MERGE"===t?BigInt(r):void 0,rows:n??[]}}catch(e){throw e2(e,Error())}}async *streamQuery(e,t){if(!this.#J.cursor)throw Error("'cursor' is not present in your postgres dialect config. It's required to make streaming work in postgres.");if(!Number.isInteger(t)||t<=0)throw Error("chunkSize must be a positive integer");let r=this.#G.query(new this.#J.cursor(e.sql,e.parameters.slice()));try{for(;;){let e=await r.read(t);if(0===e.length)break;yield{rows:e}}}finally{await r.close()}}[tC](){this.#G.release()}}class tv{#F;constructor(e){this.#F=e}async getSchemas(){return(await this.#F.selectFrom("pg_catalog.pg_namespace").select("nspname").$castTo().execute()).map(e=>({name:e.nspname}))}async getTables(e={withInternalKyselyTables:!1}){let t=this.#F.selectFrom("pg_catalog.pg_attribute as a").innerJoin("pg_catalog.pg_class as c","a.attrelid","c.oid").innerJoin("pg_catalog.pg_namespace as ns","c.relnamespace","ns.oid").innerJoin("pg_catalog.pg_type as typ","a.atttypid","typ.oid").innerJoin("pg_catalog.pg_namespace as dtns","typ.typnamespace","dtns.oid").select(["a.attname as column","a.attnotnull as not_null","a.atthasdef as has_default","c.relname as table","c.relkind as table_type","ns.nspname as schema","typ.typname as type","dtns.nspname as type_schema",e8.sql`col_description(a.attrelid, a.attnum)`.as("column_description"),e8.sql`pg_get_serial_sequence(quote_ident(ns.nspname) || '.' || quote_ident(c.relname), a.attname)`.as("auto_incrementing")]).where("c.relkind","in",["r","v","p"]).where("ns.nspname","!~","^pg_").where("ns.nspname","!=","information_schema").where("ns.nspname","!=","crdb_internal").where(e8.sql`has_schema_privilege(ns.nspname, 'USAGE')`).where("a.attnum",">=",0).where("a.attisdropped","!=",!0).orderBy("ns.nspname").orderBy("c.relname").orderBy("a.attnum").$castTo();e.withInternalKyselyTables||(t=t.where("c.relname","!=",e4.DEFAULT_MIGRATION_TABLE).where("c.relname","!=",e4.DEFAULT_MIGRATION_LOCK_TABLE));let r=await t.execute();return this.#K(r)}async getMetadata(e){return{tables:await this.getTables(e)}}#K(e){return e.reduce((e,r)=>{let n=e.find(e=>e.name===r.table&&e.schema===r.schema);return n||(n=(0,t.freeze)({name:r.table,isView:"v"===r.table_type,schema:r.schema,columns:[]}),e.push(n)),n.columns.push((0,t.freeze)({name:r.column,dataType:r.type,dataTypeSchema:r.type_schema,isNullable:!r.not_null,isAutoIncrementing:null!==r.auto_incrementing,hasDefaultValue:r.has_default,comment:r.column_description??void 0})),e},[])}}var tI=ta;let tE=/"/g;class tq extends tI.DefaultQueryCompiler{sanitizeIdentifier(e){return e.replace(tE,'""')}}let tW=BigInt("3853314791062309107");class tA extends e3{get supportsTransactionalDdl(){return!0}get supportsReturning(){return!0}async acquireMigrationLock(e,t){await e8.sql`select pg_advisory_xact_lock(${e8.sql.lit(tW)})`.execute(e)}async releaseMigrationLock(e,t){}}class tk{#q;constructor(e){this.#q=e}createDriver(){return new t_(this.#q)}createQueryCompiler(){return new tq}createAdapter(){return new tA}createIntrospector(e){return new tv(e)}}var tQ=e.i(8134);class tD{#q;#Y=new tP;#F;#x;constructor(e){this.#q=(0,t.freeze)({...e})}async init(){this.#F=(0,t.isFunction)(this.#q.database)?await this.#q.database():this.#q.database,this.#x=new tO(this.#F),this.#q.onCreateConnection&&await this.#q.onCreateConnection(this.#x)}async acquireConnection(){return await this.#Y.lock(),this.#x}async beginTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("begin"))}async commitTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("commit"))}async rollbackTransaction(e){await e.executeQuery(e6.CompiledQuery.raw("rollback"))}async savepoint(e,t,r){await e.executeQuery(r(tp("savepoint",t),(0,eu.createQueryId)()))}async rollbackToSavepoint(e,t,r){await e.executeQuery(r(tp("rollback to",t),(0,eu.createQueryId)()))}async releaseSavepoint(e,t,r){await e.executeQuery(r(tp("release",t),(0,eu.createQueryId)()))}async releaseConnection(){this.#Y.unlock()}async destroy(){this.#F?.close()}}class tO{#F;constructor(e){this.#F=e}executeQuery(e){let{sql:t,parameters:r}=e,n=this.#F.prepare(t);if(n.reader)return Promise.resolve({rows:n.all(r)});let{changes:o,lastInsertRowid:i}=n.run(r);return Promise.resolve({numAffectedRows:null!=o?BigInt(o):void 0,insertId:null!=i?BigInt(i):void 0,rows:[]})}async *streamQuery(e,t){let{sql:r,parameters:n,query:o}=e,i=this.#F.prepare(r);if(tQ.SelectQueryNode.is(o))for(let e of i.iterate(n))yield{rows:[e]};else throw Error("Sqlite driver only supports streaming of select queries")}}class tP{#H;#X;async lock(){for(;this.#H;)await this.#H;this.#H=new Promise(e=>{this.#X=e})}unlock(){let e=this.#X;this.#H=void 0,this.#X=void 0,e?.()}}var tz=ta;let tS=/"/g;class tM extends tz.DefaultQueryCompiler{visitOrAction(e){this.append("or "),this.append(e.action)}getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(tS,'""')}visitDefaultInsertValue(e){this.append("null")}}class tL{#F;constructor(e){this.#F=e}async getSchemas(){return[]}async getTables(e={withInternalKyselyTables:!1}){return await this.#Z(e)}async getMetadata(e){return{tables:await this.getTables(e)}}#ee(e,t){let r=e.selectFrom("sqlite_master").where("type","in",["table","view"]).where("name","not like","sqlite_%").select(["name","sql","type"]).orderBy("name");return t.withInternalKyselyTables||(r=r.where("name","!=",e4.DEFAULT_MIGRATION_TABLE).where("name","!=",e4.DEFAULT_MIGRATION_LOCK_TABLE)),r}async #Z(e){let t=await this.#ee(this.#F,e).execute(),r=await this.#F.with("table_list",t=>this.#ee(t,e)).selectFrom(["table_list as tl",e8.sql`pragma_table_info(tl.name)`.as("p")]).select(["tl.name as table","p.cid","p.name","p.type","p.notnull","p.dflt_value","p.pk"]).orderBy("tl.name").orderBy("p.cid").execute(),n={};for(let e of r)n[e.table]??=[],n[e.table].push(e);return t.map(({name:e,sql:t,type:r})=>{let o=t?.split(/[\(\),]/)?.find(e=>e.toLowerCase().includes("autoincrement"))?.trimStart()?.split(/\s+/)?.[0]?.replace(/["`]/g,""),i=n[e]??[];if(!o){let e=i.filter(e=>e.pk>0);1===e.length&&"integer"===e[0].type.toLowerCase()&&(o=e[0].name)}return{name:e,isView:"view"===r,columns:i.map(e=>({name:e.name,dataType:e.type,isNullable:!e.notnull,isAutoIncrementing:e.name===o,hasDefaultValue:null!=e.dflt_value,comment:void 0}))}})}}class tR extends e3{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}class tB{#q;constructor(e){this.#q=(0,t.freeze)({...e})}createDriver(){return new tD(this.#q)}createQueryCompiler(){return new tM}createAdapter(){return new tR}createIntrospector(e){return new tL(e)}}function t$(e){if(!e)return null;if("dialect"in e)return t$(e.dialect);if("createDriver"in e){if(e instanceof tB)return"sqlite";if(e instanceof tN)return"mysql";if(e instanceof tk)return"postgres";if(e instanceof tu)return"mssql"}return"aggregate"in e?"sqlite":"getConnection"in e?"mysql":"connect"in e?"postgres":"fileControl"in e||"open"in e&&"close"in e&&"prepare"in e?"sqlite":null}let tF=async t=>{let r,n=t.database;if(!n)return{kysely:null,databaseType:null,transaction:void 0};if("db"in n)return{kysely:n.db,databaseType:n.type,transaction:n.transaction};if("dialect"in n)return{kysely:new eK({dialect:n.dialect}),databaseType:n.type,transaction:n.transaction};let o=t$(n);if("createDriver"in n&&(r=n),"aggregate"in n&&!("createSession"in n)&&(r=new tB({database:n})),"getConnection"in n&&(r=new tN(n)),"connect"in n&&(r=new tk({pool:n})),"fileControl"in n){let{BunSqliteDialect:t}=await e.A(67642);r=new t({database:n})}if("createSession"in n){let t;try{({DatabaseSync:t}=await import("node:sqlite"))}catch(e){if(null!==e&&"object"==typeof e&&"code"in e&&"ERR_UNKNOWN_BUILTIN_MODULE"!==e.code)throw e}if(t&&n instanceof t){let{NodeSqliteDialect:t}=await e.A(37421);r=new t({database:n})}}return{kysely:r?new eK({dialect:r}):null,databaseType:o,transaction:void 0}};e.s(["createKyselyAdapter",()=>tF,"getKyselyDatabaseType",()=>t$],44871)}];

//# sourceMappingURL=9e883_better-auth_dist_adapters_kysely-adapter_dialect_mjs_f724c9ea._.js.map