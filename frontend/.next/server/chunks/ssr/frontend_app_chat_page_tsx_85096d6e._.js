module.exports=[16047,a=>{"use strict";var b=a.i(57850),c=a.i(45056),d=a.i(93609);function e(a,b=5e3){if(!a)return{valid:!1,error:"Message cannot be empty"};let c=a.trim();return 0===c.length?{valid:!1,error:"Message cannot be only whitespace"}:c.length>b?{valid:!1,error:`Message exceeds maximum length of ${b} characters`}:{valid:!0}}function f(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let b=16*Math.random()|0;return("x"===a?b:3&b|8).toString(16)})}function g(a){if(a instanceof TypeError)return{code:"NETWORK_ERROR",message:"Network connection failed. Please check your connection.",action:"retry"};if("object"==typeof a&&null!==a&&"status"in a){let b=a.status;if(400===b)return{code:"VALIDATION_ERROR",message:"Invalid message. Please check your input and try again.",action:"clarify"};if(404===b)return{code:"NOT_FOUND",message:"Conversation not found. It may have been deleted. Start a new conversation.",action:"new"};if(401===b)return{code:"UNAUTHORIZED",message:"Your session has expired. Please log in again.",action:"login"};if(500===b)return{code:"SERVER_ERROR",message:"Server error. Please try again in a moment.",action:"retry"};if(503===b)return{code:"SERVICE_UNAVAILABLE",message:"Service temporarily unavailable. Please try again later.",action:"retry"}}return a instanceof Error&&a.message.includes("timeout")?{code:"TIMEOUT",message:"Request took too long. Please try again.",action:"retry"}:{code:"UNKNOWN_ERROR",message:"An unexpected error occurred. Please try again.",action:"retry"}}function h(a){return/^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)}let i="https://mushariq-full-stack-todo.hf.space/api/chat",j="Request took too long. Please try again.",k="Conversation not found. It may have been deleted. Start a new conversation.",l="Failed to load conversation. Please try again.",m={user:"bg-blue-100 text-blue-900 rounded-lg",assistant:"bg-gray-100 text-gray-900 rounded-lg",system:"bg-yellow-50 text-yellow-800 rounded-lg"},n={user:"justify-end",assistant:"justify-start",system:"justify-center"},o="chat_last_conversation_id",p=({messages:a})=>(0,b.jsx)("div",{className:"space-y-4",children:a.map(a=>(0,b.jsx)(q,{message:a},a.id))}),q=({message:a})=>{let c=n[a.role],d=m[a.role],e="system"===a.role?"max-w-full":"max-w-xs sm:max-w-sm md:max-w-md lg:max-w-lg";return(0,b.jsx)("div",{className:`flex ${c}`,children:(0,b.jsxs)("div",{className:`${e} px-4 py-3 ${d} ${"system"===a.role?"text-center text-sm italic":""}`,role:"article","aria-label":a.isLoading?"Loading response":"Message",children:[a.isLoading&&a.toolName&&(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsxs)("span",{className:"text-xs font-medium",children:["Executing ",a.toolName,"..."]}),(0,b.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full"}),(0,b.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-100"}),(0,b.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-200"})]}),a.isLoading&&!a.toolName&&(0,b.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,b.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full"}),(0,b.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-100"}),(0,b.jsx)("div",{className:"animate-bounce h-2 w-2 bg-current rounded-full animation-delay-200"})]}),!a.isLoading&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-sm break-words",children:a.content}),a.toolResult&&(0,b.jsxs)("div",{className:"mt-2 pt-2 border-t border-current border-opacity-20",children:[(0,b.jsx)("p",{className:"text-xs font-semibold mb-1",children:a.toolName?`${a.toolName} Result:`:"Tool Result:"}),(0,b.jsx)("pre",{className:"text-xs overflow-x-auto bg-black bg-opacity-10 p-2 rounded",children:JSON.stringify(a.toolResult,null,2)})]}),a.error&&(0,b.jsxs)("div",{className:"mt-2 pt-2 border-t border-red-300",role:"alert",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-red-600",children:"Error:"}),(0,b.jsx)("p",{className:"text-xs text-red-600",children:a.error})]}),(0,b.jsx)("p",{className:"text-xs opacity-70 mt-1",children:function(a,b=!1){try{let c=new Date(a);if(b)return c.toLocaleString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"});return c.toLocaleString("en-US",{hour:"2-digit",minute:"2-digit"})}catch(b){return a}}(a.createdAt)})]})]})})},r=({value:a,onChange:d,onSubmit:f,isLoading:g,disabled:h=!1})=>{let i=(0,c.useRef)(null),[j,k]=(0,c.useState)(null),l=async b=>{b.preventDefault();let c=e(a);if(!c.valid)return void k(c.error||"Invalid message");k(null);try{await f(a)}catch(a){k(a instanceof Error?a.message:"Failed to send message")}};return(0,c.useEffect)(()=>{i.current&&(i.current.style.height="auto",i.current.style.height=`${Math.min(i.current.scrollHeight,120)}px`)},[a]),(0,c.useEffect)(()=>{i.current?.focus()},[]),(0,b.jsxs)("form",{onSubmit:l,className:"space-y-3",children:[j&&(0,b.jsx)("div",{className:"text-sm text-red-600 bg-red-50 px-3 py-2 rounded border border-red-200",role:"alert",children:j}),(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsxs)("div",{className:"flex-1 relative",children:[(0,b.jsx)("label",{htmlFor:"message-input",className:"sr-only",children:"Message input"}),(0,b.jsx)("textarea",{ref:i,id:"message-input",value:a,onChange:a=>{d(a.target.value),k(null)},onKeyDown:a=>{if("Enter"===a.key&&!a.shiftKey&&!h){a.preventDefault();let b=i.current?.form;b&&b.dispatchEvent(new Event("submit",{bubbles:!0}))}},placeholder:"Type your message here...",disabled:h,maxLength:5e3,rows:1,className:`w-full px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none transition-all ${h?"bg-gray-100 text-gray-400 cursor-not-allowed opacity-50":"bg-white text-gray-900"} focus:opacity-100`,"aria-label":"Message input","aria-disabled":h,"aria-describedby":"character-count","data-testid":"message-input"})]}),(0,b.jsx)("button",{type:"submit",disabled:h||!a.trim(),className:`px-4 py-2 rounded-lg font-medium transition-all whitespace-nowrap focus:outline-none focus:ring-2 focus:ring-offset-2 ${h||!a.trim()?"bg-gray-300 text-gray-500 cursor-not-allowed":"bg-blue-600 text-white hover:bg-blue-700 active:bg-blue-800 focus:ring-blue-500"}`,"aria-label":g?"Sending message":"Send message","aria-busy":g,"data-testid":"send-button",children:g?(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("span",{className:"inline-block","aria-hidden":"true",children:(0,b.jsxs)("svg",{className:"w-4 h-4 animate-spin",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,b.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,b.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]})}),"Sending..."]}):"Send"})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("p",{id:"character-count",className:"text-xs text-gray-500","aria-live":"polite","aria-atomic":"true",children:[a.length,"/",5e3," characters"]}),a.length>4500&&(0,b.jsx)("p",{className:"text-xs text-yellow-600",role:"status",children:"You are approaching the character limit"})]}),(0,b.jsxs)("p",{className:"text-xs text-gray-400 italic",children:["Press ",(0,b.jsx)("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-gray-700",children:"Enter"})," to send,"," ",(0,b.jsx)("kbd",{className:"bg-gray-100 px-2 py-1 rounded text-gray-700",children:"Shift+Enter"})," for new line"]})]})},s=({conversationId:a})=>{let m=(0,d.useRouter)(),n=(0,c.useRef)(null),{conversation:q,inputValue:s,setInputValue:t,sendMessage:u,loadConversationHistory:v,error:w,isLoading:x,clearError:y}=(()=>{let[a,b]=(0,c.useState)(null),[d,m]=(0,c.useState)(""),[n,p]=(0,c.useState)(null),[q,r]=(0,c.useState)(!1),s=(0,c.useCallback)(()=>{p(null)},[]),t=(0,c.useCallback)(async c=>{let d=e(c);if(!d.valid)return void p(d.error||"Message cannot be empty");s(),r(!0);try{let d={id:f(),role:"user",content:c.trim(),createdAt:new Date().toISOString(),isLoading:!1},e={...a||{id:"",messages:[],isLoading:!1,createdAt:new Date().toISOString()},messages:[...a?.messages||[],d],lastMessageAt:new Date().toISOString()};b(e),m("");let h={id:f(),role:"assistant",content:"Typing...",createdAt:new Date().toISOString(),isLoading:!0};b(a=>a?{...a,messages:[...a.messages,h]}:null);let k={message:c.trim(),conversation_id:a?.id},l=new AbortController,n=setTimeout(()=>l.abort(),3e4);try{let a=await fetch(i,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k),signal:l.signal,credentials:"include"});if(clearTimeout(n),!a.ok){let b=await a.json().catch(()=>({})),c={status:a.status,...b},{message:d}=g(c);throw Error(d)}let c=await a.json(),d={id:f(),role:"assistant",content:c.response,toolName:c.toolName,toolResult:c.toolResult,createdAt:new Date().toISOString(),isLoading:!1};if(b(a=>{if(!a)return null;let b=a.messages.slice(0,-1);return b.push(d),{...a,id:c.conversation_id,messages:b,lastMessageAt:new Date().toISOString()}}),c.conversation_id)try{localStorage.setItem(o,JSON.stringify({id:c.conversation_id,lastAccessedAt:new Date().toISOString()}))}catch(a){console.warn("Failed to save conversation to localStorage:",a)}}catch(a){clearTimeout(n),b(a=>a?{...a,messages:a.messages.slice(0,-1)}:null),a instanceof Error?"AbortError"===a.name?p(j):p(a.message):p("An unexpected error occurred. Please try again.")}}catch(b){let{message:a}=g(b);p(a)}finally{r(!1)}},[a,s]),u=(0,c.useCallback)(async a=>{if(!a||!h(a))return p(k),[];r(!0),s();try{let c=new AbortController,d=setTimeout(()=>c.abort(),3e4);try{let e=await fetch(`${i}?conversation_id=${encodeURIComponent(a)}`,{method:"GET",headers:{"Content-Type":"application/json"},signal:c.signal,credentials:"include"});if(clearTimeout(d),!e.ok){if(404===e.status)p(k),localStorage.removeItem(o);else if(401===e.status)p("Your session has expired. Please log in again.");else throw Error(l);return[]}let f=await e.json();if(f.messages&&Array.isArray(f.messages)){let c={id:a,messages:f.messages,isLoading:!1,createdAt:f.createdAt||new Date().toISOString(),lastMessageAt:f.lastMessageAt||new Date().toISOString()};return b(c),f.messages}return[]}catch(a){return clearTimeout(d),a instanceof Error?"AbortError"===a.name?p(j):p(a.message):p(l),[]}}finally{r(!1)}},[s]),v=(0,c.useCallback)(()=>{try{let a=localStorage.getItem(o);if(!a)return null;try{let b=JSON.parse(a);if(b&&"object"==typeof b&&"id"in b){let a=b.id;return h(a)?a:null}}catch{if(h(a))return a}return null}catch{return null}},[]);return(0,c.useEffect)(()=>{if(!a){let a=v();a&&u(a)}},[]),{conversation:a,inputValue:d,setInputValue:m,sendMessage:t,loadConversationHistory:u,error:n,isLoading:q,clearError:s}})(),[z,A]=(0,c.useState)(!1);(0,c.useEffect)(()=>{let b=!0;return(async()=>{if(!a){b&&A(!1);return}if(!z||q?.id!==a)try{await v(a),b&&A(!0)}catch(a){b&&A(!0)}})(),()=>{b=!1}},[a,q?.id,z,v]),(0,c.useEffect)(()=>{n.current?.scrollIntoView({behavior:"smooth"})},[q?.messages]),(0,c.useEffect)(()=>{q?.id&&q.id!==a&&m.push(`/chat?id=${q.id}`,{scroll:!1})},[q?.id,a,m]);let B=async a=>{a.trim()&&await u(a)};return(0,b.jsxs)("div",{className:"flex flex-col h-[calc(100vh-200px)] bg-white rounded-lg border border-gray-200 shadow-sm",role:"region","aria-label":"Chat interface",children:[(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-4 sm:p-6 space-y-4 bg-gray-50 max-h-screen",children:x&&(!q||0===q.messages.length)?(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{className:"flex justify-center mb-4",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-4 border-blue-200 border-t-blue-600"})}),(0,b.jsx)("p",{className:"text-gray-600 font-medium",children:"Loading conversation..."})]})}):q&&0!==q.messages.length?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p,{messages:q.messages}),(0,b.jsx)("div",{ref:n})]}):(0,b.jsx)("div",{className:"flex items-center justify-center h-full text-center",children:(0,b.jsxs)("div",{className:"max-w-md",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-3",children:"Start a New Conversation"}),(0,b.jsx)("p",{className:"text-gray-600 mb-4",children:"Chat naturally to manage your tasks. Try asking something like:"}),(0,b.jsxs)("ul",{className:"text-sm text-gray-500 space-y-1 mb-4",children:[(0,b.jsx)("li",{children:'"Add a task: buy milk"'}),(0,b.jsx)("li",{children:'"List all my tasks"'}),(0,b.jsx)("li",{children:'"Mark task as done"'})]})]})})}),w&&(0,b.jsx)("div",{className:"px-6 py-4 bg-red-50 border-t border-red-200",children:(0,b.jsxs)("div",{className:"flex items-start justify-between gap-3",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsx)("p",{className:"text-sm font-medium text-red-900",children:w})}),(0,b.jsxs)("button",{onClick:y,className:"ml-2 inline-flex text-red-400 hover:text-red-600 focus:outline-none transition-colors","aria-label":"Close error message",children:[(0,b.jsx)("span",{className:"sr-only",children:"Close"}),(0,b.jsx)("svg",{className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,b.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})]})]})}),(0,b.jsx)("div",{className:"border-t border-gray-200 p-6 bg-white",children:(0,b.jsx)(r,{value:s,onChange:t,onSubmit:B,isLoading:x,disabled:x})})]})};var t=a.i(37720);function u(){let a,e=(0,d.useSearchParams)();if(e){let b=e.get("id");b&&/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/i.test(b)&&(a=b)}let{isAuthenticated:f,loading:g}=(0,t.useAuth)(),[h,i]=(0,c.useState)(!1);return((0,c.useEffect)(()=>{i(!0)},[]),g||!h)?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading chat..."})]})}):f?(0,b.jsxs)("div",{className:"min-h-screen bg-white",children:[(0,b.jsx)("header",{className:"bg-white border-b border-gray-200 shadow-sm",children:(0,b.jsxs)("div",{className:"max-w-6xl mx-auto px-4 py-4 flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Todo Chat"}),(0,b.jsx)("p",{className:"text-sm text-gray-600 mt-1",children:"Chat naturally to manage your tasks"})]}),(0,b.jsxs)("a",{href:"/dashboard",className:"inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500",children:[(0,b.jsx)("svg",{className:"h-5 w-5 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,b.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 19V6l12-3v13M9 19H7a2 2 0 01-2-2m2 2h2a2 2 0 002-2M9 19l12-3"})}),"My Tasks"]})]})}),(0,b.jsx)("main",{className:"max-w-6xl mx-auto px-4 py-8",children:(0,b.jsx)(s,{conversationId:a||void 0})})]}):(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mb-4",children:"Authentication Required"}),(0,b.jsx)("p",{className:"text-gray-600 mb-6",children:"Please log in to use the chat feature."}),(0,b.jsx)("a",{href:"/login",className:"inline-block px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition",children:"Go to Login"})]})})}function v(){return(0,b.jsx)(c.Suspense,{fallback:(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-gray-50",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,b.jsx)("p",{className:"text-gray-600",children:"Loading..."})]})}),children:(0,b.jsx)(u,{})})}a.s(["default",()=>v,"dynamic",0,"force-dynamic"],16047)}];

//# sourceMappingURL=frontend_app_chat_page_tsx_85096d6e._.js.map