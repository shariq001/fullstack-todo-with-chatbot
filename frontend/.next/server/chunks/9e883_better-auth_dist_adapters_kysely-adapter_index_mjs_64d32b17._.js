module.exports=[53055,e=>{"use strict";var t=e.i(44871),r=e.i(47908);e.i(5194);var l=e.i(31238);let i=(e,t)=>{let i=null,a=e=>({getFieldName:l,schema:i,getDefaultFieldName:a,getDefaultModelName:n,getFieldAttributes:s,getModelName:o})=>{let u=e=>{let t=[],l=[];if(e)for(let[a,s]of Object.entries(e)){let e=i[n(a)]?.fields,[s,o]=a.includes(".")?a.split("."):[void 0,a];if(e)for(let[i,n]of(e.id={type:"string"},Object.entries(e)))t.push(r.sql`${r.sql.ref(`join_${o}`)}.${r.sql.ref(n.fieldName||i)} as ${r.sql.ref(`_joined_${o}_${n.fieldName||i}`)}`),l.push({joinModel:a,joinModelRef:o,fieldName:n.fieldName||i})}return{allSelectsStr:l,allSelects:t}},d=async(r,i,a,n)=>{if(t?.type==="mysql"){await i.execute();let t=r.id?"id":n.length>0&&n[0]?.field?n[0].field:"id";if(!r.id&&0===n.length)return await e.selectFrom(a).selectAll().orderBy(l({model:a,field:t}),"desc").limit(1).executeTakeFirst();let s=r[t]||n[0]?.value;return await e.selectFrom(a).selectAll().orderBy(l({model:a,field:t}),"desc").where(l({model:a,field:t}),"=",s).limit(1).executeTakeFirst()}return t?.type==="mssql"?await i.outputAll("inserted").executeTakeFirst():await i.returningAll().executeTakeFirst()};function f(e,t){if(!t)return{and:null,or:null};let r=[],i=[];return t.forEach(t=>{let{field:a,value:n,operator:s="=",connector:o="AND"}=t,u=l({model:e,field:a}),d=t=>{let r=`${e}.${u}`;return"in"===s.toLowerCase()?t(r,"in",Array.isArray(n)?n:[n]):"not_in"===s.toLowerCase()?t(r,"not in",Array.isArray(n)?n:[n]):"contains"===s?t(r,"like",`%${n}%`):"starts_with"===s?t(r,"like",`${n}%`):"ends_with"===s?t(r,"like",`%${n}`):t(r,"eq"===s?"=":"ne"===s?"<>":"gt"===s?">":"gte"===s?">=":"lt"===s?"<":"lte"===s?"<=":s,n)};"OR"===o?i.push(d):r.push(d)}),{and:r.length?r:null,or:i.length?i:null}}function c(e,t,r){if(!t||!e.length)return e;let i=new Map;for(let a of e){let e={},n={};for(let[e]of Object.entries(t))n[o(e)]={};for(let[t,i]of Object.entries(a)){let a=String(t),s=!1;for(let{joinModel:e,fieldName:t,joinModelRef:u}of r)if(a===`_joined_${u}_${t}`){n[o(e)][l({model:e,field:t})]=i,s=!0;break}s||(e[t]=i)}let s=e.id;if(!s)continue;if(!i.has(s)){let r={...e};for(let[e,l]of Object.entries(t))r[o(e)]="one-to-one"===l.relation?null:[];i.set(s,r)}let u=i.get(s);for(let[e,r]of Object.entries(t)){let t="one-to-one"===r.relation,i=r.limit??100,a=n[o(e)],s=a&&Object.keys(a).length>0&&Object.values(a).some(e=>null!=e);if(t)u[o(e)]=s?a:null;else{let t=o(e);if(Array.isArray(u[t])&&s){if(u[t].length>=i)continue;let r=l({model:e,field:"id"}),n=a[r];n?!u[t].some(e=>e[r]===n)&&u[t].length<i&&u[t].push(a):u[t].length<i&&u[t].push(a)}}}}let a=Array.from(i.values());for(let e of a)for(let[r,l]of Object.entries(t))if("one-to-one"!==l.relation){let t=o(r);if(Array.isArray(e[t])){let r=l.limit??100;e[t].length>r&&(e[t]=e[t].slice(0,r))}}return a}return{create:async({data:t,model:r})=>await d(t,e.insertInto(r).values(t),r,[]),async findOne({model:t,where:r,select:l,join:i}){let{and:a,or:n}=f(t,r),s=e.selectFrom(e=>{let r=e.selectFrom(t);return a&&(r=r.where(e=>e.and(a.map(t=>t(e))))),n&&(r=r.where(e=>e.or(n.map(t=>t(e))))),r.selectAll().as("primary")}).selectAll("primary");if(i)for(let[e,t]of Object.entries(i)){let[r,l]=e.includes(".")?e.split("."):[void 0,e];s=s.leftJoin(`${e} as join_${l}`,e=>e.onRef(`join_${l}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:o,allSelects:d}=u(i);s=s.select(d);let p=await s.execute();if(!p||!Array.isArray(p)||0===p.length)return null;let y=p[0];return i?c(p,i,o)[0]:y},async findMany({model:r,where:i,limit:a,offset:n,sortBy:s,join:o}){let{and:d,or:p}=f(r,i),y=e.selectFrom(e=>{let i=e.selectFrom(r);return t?.type==="mssql"?void 0!==n?(s||(i=i.orderBy(l({model:r,field:"id"}))),i=i.offset(n).fetch(a||100)):void 0!==a&&(i=i.top(a)):(void 0!==a&&(i=i.limit(a)),void 0!==n&&(i=i.offset(n))),s?.field&&(i=i.orderBy(`${l({model:r,field:s.field})}`,s.direction)),d&&(i=i.where(e=>e.and(d.map(t=>t(e))))),p&&(i=i.where(e=>e.or(p.map(t=>t(e))))),i.selectAll().as("primary")}).selectAll("primary");if(o)for(let[e,t]of Object.entries(o)){let[r,l]=e.includes(".")?e.split("."):[void 0,e];y=y.leftJoin(`${e} as join_${l}`,e=>e.onRef(`join_${l}.${t.on.to}`,"=",`primary.${t.on.from}`))}let{allSelectsStr:m,allSelects:h}=u(o);y=y.select(h),s?.field&&(y=y.orderBy(`${l({model:r,field:s.field})}`,s.direction));let w=await y.execute();return w?o?c(w,o,m):w:[]},async update({model:t,where:r,update:l}){let{and:i,or:a}=f(t,r),n=e.updateTable(t).set(l);return i&&(n=n.where(e=>e.and(i.map(t=>t(e))))),a&&(n=n.where(e=>e.or(a.map(t=>t(e))))),await d(l,n,t,r)},async updateMany({model:t,where:r,update:l}){let{and:i,or:a}=f(t,r),n=e.updateTable(t).set(l);i&&(n=n.where(e=>e.and(i.map(t=>t(e))))),a&&(n=n.where(e=>e.or(a.map(t=>t(e)))));let s=(await n.executeTakeFirst()).numUpdatedRows;return s>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number(s)},async count({model:t,where:r}){let{and:l,or:i}=f(t,r),a=e.selectFrom(t).select(e.fn.count("id").as("count"));l&&(a=a.where(e=>e.and(l.map(t=>t(e))))),i&&(a=a.where(e=>e.or(i.map(t=>t(e)))));let n=await a.execute();return"number"==typeof n[0].count?n[0].count:"bigint"==typeof n[0].count?Number(n[0].count):parseInt(n[0].count)},async delete({model:t,where:r}){let{and:l,or:i}=f(t,r),a=e.deleteFrom(t);l&&(a=a.where(e=>e.and(l.map(t=>t(e))))),i&&(a=a.where(e=>e.or(i.map(t=>t(e))))),await a.execute()},async deleteMany({model:t,where:r}){let{and:l,or:i}=f(t,r),a=e.deleteFrom(t);l&&(a=a.where(e=>e.and(l.map(t=>t(e))))),i&&(a=a.where(e=>e.or(i.map(t=>t(e)))));let n=(await a.executeTakeFirst()).numDeletedRows;return n>Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:Number(n)},options:t}},n=null;n={config:{adapterId:"kysely",adapterName:"Kysely Adapter",usePlural:t?.usePlural,debugLogs:t?.debugLogs,supportsBooleans:t?.type!=="sqlite"&&t?.type!=="mssql"&&t?.type!=="mysql"&&!!t?.type,supportsDates:t?.type!=="sqlite"&&t?.type!=="mssql"&&!!t?.type,supportsJSON:t?.type==="postgres",supportsArrays:!1,supportsUUIDs:t?.type==="postgres",transaction:!!t?.transaction&&(t=>e.transaction().execute(e=>t((0,l.createAdapterFactory)({config:n.config,adapter:a(e)})(i))))},adapter:a(e)};let s=(0,l.createAdapterFactory)(n);return e=>(i=e,s(e))};e.s([],87573),e.i(87573),e.s(["createKyselyAdapter",()=>t.createKyselyAdapter,"getKyselyDatabaseType",()=>t.getKyselyDatabaseType,"kyselyAdapter",()=>i],53055)}];

//# sourceMappingURL=9e883_better-auth_dist_adapters_kysely-adapter_index_mjs_64d32b17._.js.map