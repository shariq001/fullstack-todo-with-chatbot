module.exports=[50940,e=>{"use strict";e.i(553);var t=e.i(40553);e.i(5194);var r=e.i(31238);let n=(e,n)=>{let a=null,l=(0,r.createAdapterFactory)({config:{adapterId:"memory",adapterName:"Memory Adapter",usePlural:!1,debugLogs:n?.debugLogs||!1,supportsArrays:!0,customTransformInput:t=>(t.options.advanced?.database?.useNumberId||t.options.advanced?.database?.generateId==="serial")&&"id"===t.field&&"create"===t.action?e[t.model].length+1:t.data,transaction:async t=>{let r=structuredClone(e);try{return await t(l(a))}catch(t){throw Object.keys(e).forEach(t=>{e[t]=r[t]}),t}}},adapter:({getFieldName:r,options:n,getModelName:a})=>{let l=(e,t,n)=>t?e.sort((e,a)=>{let l=r({model:n,field:t.field}),o=e[l],i=a[l],s=0;return s=null==o&&null==i?0:null==o?-1:null==i?1:"string"==typeof o&&"string"==typeof i?o.localeCompare(i):o instanceof Date&&i instanceof Date?o.getTime()-i.getTime():"number"==typeof o&&"number"==typeof i?o-i:"boolean"==typeof o&&"boolean"==typeof i?o===i?0:o?1:-1:String(o).localeCompare(String(i)),"asc"===t.direction?s:-s}):e;function o(r,n,l){let o=(r,n)=>{let a=e[n];if(!a)throw t.logger.error(`[MemoryAdapter] Model ${n} not found in the DB`,Object.keys(e)),Error(`Model ${n} not found`);let l=(e,t)=>{let{field:r,value:n,operator:a}=t;switch(a){case"in":if(!Array.isArray(n))throw Error("Value must be an array");return n.includes(e[r]);case"not_in":if(!Array.isArray(n))throw Error("Value must be an array");return!n.includes(e[r]);case"contains":return e[r].includes(n);case"starts_with":return e[r].startsWith(n);case"ends_with":return e[r].endsWith(n);case"ne":return e[r]!==n;case"gt":return null!=n&&e[r]>n;case"gte":return null!=n&&e[r]>=n;case"lt":return null!=n&&e[r]<n;case"lte":return null!=n&&e[r]<=n;default:return e[r]===n}};return a.filter(e=>{if(!r.length||0===r.length)return!0;let t=l(e,r[0]);for(let n of r){let r=l(e,n);t="OR"===n.connector?t||r:t&&r}return t})};if(!l)return o(r,n);let i=o(r,n),s=new Map,u=new Map;for(let r of i){let n=String(r.id);if(!s.has(n)){let e={...r};for(let[t,r]of Object.entries(l)){let l=a(t);"one-to-one"===r.relation?e[l]=null:(e[l]=[],u.set(`${n}-${t}`,new Set))}s.set(n,e)}let o=s.get(n);for(let[i,s]of Object.entries(l)){let l=a(i),d=e[l];if(!d)throw t.logger.error(`[MemoryAdapter] JoinOption model ${l} not found in the DB`,Object.keys(e)),Error(`JoinOption model ${l} not found`);let c=d.filter(e=>e[s.on.to]===r[s.on.from]);if("one-to-one"===s.relation)o[l]=c[0]||null;else{let e=u.get(`${n}-${i}`),t=s.limit??100,r=0;for(let n of c){if(r>=t)break;!e.has(n.id)&&(o[l].push(n),e.add(n.id),r++)}}}}return Array.from(s.values())}return{create:async({model:t,data:r})=>((n.advanced?.database?.useNumberId||n.advanced?.database?.generateId==="serial")&&(r.id=e[a(t)].length+1),e[t]||(e[t]=[]),e[t].push(r),r),findOne:async({model:e,where:t,join:r})=>{let n=o(t,e,r);return r?n.length?n[0]:null:n[0]||null},findMany:async({model:e,where:t,sortBy:r,limit:n,offset:a,join:i})=>{let s=o(t||[],e,i);if(i){if(!s.length)return[];l(s,r,e);let t=s;return void 0!==a&&(t=t.slice(a)),void 0!==n&&(t=t.slice(0,n)),t}let u=l(s,r,e);return void 0!==a&&(u=u.slice(a)),void 0!==n&&(u=u.slice(0,n)),u||[]},count:async({model:t,where:r})=>r?o(r,t).length:e[t].length,update:async({model:e,where:t,update:r})=>{let n=o(t,e);return n.forEach(e=>{Object.assign(e,r)}),n[0]||null},delete:async({model:t,where:r})=>{let n=e[t],a=o(r,t);e[t]=n.filter(e=>!a.includes(e))},deleteMany:async({model:t,where:r})=>{let n=e[t],a=o(r,t),l=0;return e[t]=n.filter(e=>a.includes(e)?(l++,!1):!a.includes(e)),l},updateMany({model:e,where:t,update:r}){let n=o(t,e);return n.forEach(e=>{Object.assign(e,r)}),n[0]||null}}}});return e=>(a=e,l(e))};e.s([],70876),e.i(70876),e.s(["memoryAdapter",()=>n],50940)}];

//# sourceMappingURL=9e883_better-auth_dist_adapters_memory-adapter_index_mjs_40b7cdd5._.js.map